<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>TaxSyncForDrivers ‚Äî Planification fiscale pour chauffeurs Uber/Lyft/Taxi</title>
    <meta
      name="description"
      content="Outil gratuit de planification fiscale pour chauffeurs de covoiturage et taxi au Qu√©bec."
    />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üöó</text></svg>"
    />
    <style>
      :root {
        --bg: #f8fafc;
        --card: #fff;
        --accent: #0a7670;
        --accent-2: #14b8a6;
        --accent-dark: #0f766e;
        --accent-light: rgba(10, 118, 112, 0.1);
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --text: #0f172a;
        --muted: #64748b;
        --border: #e2e8f0;
        --radius: 12px;
        --shadow: 0 4px 20px rgba(15, 23, 42, 0.08);
        --shadow-lg: 0 10px 40px rgba(15, 23, 42, 0.12);
      }
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }
      body {
        font-family:
          'Inter',
          -apple-system,
          BlinkMacSystemFont,
          'Segoe UI',
          sans-serif;
        background:
          linear-gradient(135deg, rgba(13, 148, 136, 0.05) 0%, rgba(20, 184, 166, 0.03) 100%),
          var(--bg);
        color: var(--text);
        line-height: 1.6;
        min-height: 100vh;
      }
      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 1rem;
      }
      header {
        background: var(--card);
        border-bottom: 1px solid var(--border);
        padding: 1rem 0;
        position: sticky;
        top: 0;
        z-index: 100;
        box-shadow: var(--shadow);
      }
      .header-content {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }
      .logo {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        font-size: 1.5rem;
        font-weight: 800;
        color: var(--accent);
        text-decoration: none;
      }
      .badge {
        background: var(--accent-light);
        color: var(--accent-dark);
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 600;
      }
      .lang-toggle {
        display: flex;
        gap: 0.5rem;
      }
      .lang-btn {
        background: transparent;
        border: 1px solid var(--border);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.2s;
      }
      .lang-btn:hover {
        border-color: var(--accent);
        color: var(--accent);
      }
      .lang-btn.active {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
      }
      .hero {
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
        color: #fff;
        padding: 3rem 2rem;
        border-radius: var(--radius);
        margin: 1.5rem 0;
        text-align: center;
        box-shadow: var(--shadow-lg);
      }
      .hero h1 {
        font-size: 2.25rem;
        font-weight: 800;
        margin-bottom: 0.75rem;
      }
      .hero p {
        font-size: 1.125rem;
        opacity: 0.95;
        max-width: 600px;
        margin: 0 auto 1.5rem;
      }
      .hero-stats {
        display: flex;
        justify-content: center;
        gap: 2rem;
        flex-wrap: wrap;
        margin-top: 1.5rem;
      }
      .hero-stat {
        text-align: center;
      }
      .hero-stat-value {
        font-size: 2rem;
        font-weight: 800;
      }
      .hero-stat-label {
        font-size: 0.875rem;
        opacity: 0.9;
      }
      .tabs {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 0.75rem;
        margin: 1.5rem 0;
      }
      .tab-btn {
        background: var(--card);
        border: 2px solid var(--border);
        border-radius: var(--radius);
        padding: 1rem;
        cursor: pointer;
        text-align: center;
        transition: all 0.2s;
        box-shadow: var(--shadow);
      }
      .tab-btn:hover {
        border-color: var(--accent);
        transform: translateY(-2px);
      }
      .tab-btn.active {
        background: var(--accent);
        color: #fff;
        border-color: var(--accent);
      }
      .tab-icon {
        font-size: 1.75rem;
        display: block;
        margin-bottom: 0.5rem;
      }
      .tab-label {
        font-weight: 700;
        font-size: 0.9rem;
      }
      .tab-content {
        display: none;
        background: var(--card);
        border-radius: var(--radius);
        padding: 2rem;
        box-shadow: var(--shadow-lg);
        border: 1px solid var(--border);
      }
      .tab-content.active {
        display: block;
      }
      .form-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
      }
      .form-group {
        margin-bottom: 1rem;
      }
      label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      .label-hint {
        font-weight: 400;
        color: var(--muted);
        font-size: 0.875rem;
      }
      input,
      select,
      textarea {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 1px solid var(--border);
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.2s;
        background: #fff;
      }
      textarea {
        min-height: 200px;
        max-width: 100%;
        resize: vertical;
        overflow-wrap: break-word;
        word-wrap: break-word;
      }
      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: var(--accent);
        box-shadow: 0 0 0 3px var(--accent-light);
      }
      .btn {
        background: linear-gradient(135deg, var(--accent) 0%, var(--accent-2) 100%);
        color: #fff;
        border: none;
        padding: 0.875rem 1.5rem;
        border-radius: 8px;
        font-size: 1rem;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.2s;
        box-shadow: var(--shadow);
      }
      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(13, 148, 136, 0.3);
      }
      .btn-secondary {
        background: var(--card);
        color: var(--text);
        border: 1px solid var(--border);
      }
      .btn-group {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
        margin-top: 1.5rem;
      }
      .result-box {
        background: linear-gradient(135deg, var(--accent-light) 0%, rgba(20, 184, 166, 0.05) 100%);
        border: 1px solid var(--accent);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-top: 1.5rem;
      }
      .result-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--accent);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .result-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
      }
      .result-item {
        background: #fff;
        padding: 1rem;
        border-radius: 8px;
        box-shadow: var(--shadow);
      }
      .result-label {
        font-size: 0.875rem;
        color: var(--muted);
        margin-bottom: 0.25rem;
      }
      .result-value {
        font-size: 1.5rem;
        font-weight: 800;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
      }
      .result-value.positive {
        color: var(--success);
      }
      .method-comparison {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin: 1.5rem 0;
      }
      .method-card {
        background: #fff;
        border: 2px solid var(--border);
        border-radius: var(--radius);
        padding: 1.25rem;
        text-align: center;
      }
      .method-card.recommended {
        border-color: var(--success);
        background: rgba(16, 185, 129, 0.05);
      }
      .method-card .amount {
        font-size: 1.75rem;
        font-weight: 800;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
      }
      .recommended-badge {
        background: var(--success);
        color: #fff;
        font-size: 0.75rem;
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        margin-top: 0.5rem;
        display: inline-block;
      }
      .payment-schedule {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-top: 1rem;
      }
      .payment-card {
        background: #fff;
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 1rem;
        text-align: center;
      }
      .payment-quarter {
        font-weight: 700;
        color: var(--accent);
      }
      .payment-date {
        font-size: 0.875rem;
        color: var(--muted);
        margin-bottom: 0.5rem;
      }
      .payment-amount {
        font-size: 1.25rem;
        font-weight: 800;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
      }
      .savings-summary {
        background: linear-gradient(135deg, var(--success) 0%, #059669 100%);
        color: #fff;
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-top: 1.5rem;
        text-align: center;
      }
      .savings-amount {
        font-size: 2.5rem;
        font-weight: 800;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
      }
      fieldset {
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
      }
      legend {
        font-weight: 700;
        padding: 0 0.5rem;
        color: var(--accent);
      }
      .toggle-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin: 1rem 0;
      }
      .toggle {
        position: relative;
        width: 50px;
        height: 26px;
      }
      .toggle input {
        opacity: 0;
        width: 0;
        height: 0;
      }
      .toggle-slider {
        position: absolute;
        cursor: pointer;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: var(--border);
        border-radius: 26px;
        transition: 0.3s;
      }
      .toggle-slider:before {
        content: '';
        position: absolute;
        height: 20px;
        width: 20px;
        left: 3px;
        bottom: 3px;
        background: #fff;
        border-radius: 50%;
        transition: 0.3s;
      }
      .toggle input:checked + .toggle-slider {
        background: var(--accent);
      }
      .toggle input:checked + .toggle-slider:before {
        transform: translateX(24px);
      }
      /* Home Office Method Selector Cards */
      .method-selector-cards {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin: 2rem 0;
      }
      .method-selector-cards .method-card {
        position: relative;
        border: 2px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        cursor: pointer;
        transition: all 0.3s ease;
        background: white;
        text-align: left;
      }
      .method-selector-cards .method-card:hover {
        border-color: #0d9488;
        box-shadow: 0 4px 12px rgba(13, 148, 136, 0.15);
        transform: translateY(-2px);
      }
      .method-selector-cards .method-card input[type="radio"] {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 20px;
        height: 20px;
        cursor: pointer;
      }
      .method-selector-cards .method-card input[type="radio"]:checked + .card-content {
        opacity: 1;
      }
      .method-selector-cards .method-card input[type="radio"]:checked {
        accent-color: #0d9488;
      }
      .method-selector-cards .method-card input[type="radio"]:not(:checked) + .card-content {
        opacity: 0.6;
      }
      .method-selector-cards .card-content h4 {
        margin: 0 0 0.5rem 0;
        color: #0f766e;
        font-size: 1.25rem;
      }
      .method-selector-cards .card-content .highlight {
        font-size: 1.1rem;
        font-weight: 600;
        color: #0d9488;
        margin: 0.5rem 0;
        display: block;
      }
      .method-selector-cards .card-content .limit {
        font-size: 0.9rem;
        color: #64748b;
        margin: 0.25rem 0 1rem 0;
        display: block;
      }
      .method-selector-cards .card-content .benefits {
        list-style: none;
        padding: 0;
        margin: 1rem 0 0 0;
      }
      .method-selector-cards .card-content .benefits li {
        padding: 0.25rem 0;
        font-size: 0.9rem;
        color: #475569;
      }
      .help-section {
        background: #f8fafc;
        border-radius: 12px;
        padding: 1.5rem;
        margin: 2rem 0;
      }
      .help-section h5 {
        color: #0f766e;
        font-size: 1.1rem;
        margin: 0 0 1rem 0;
      }
      .example-box {
        background: white;
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1rem;
        margin-bottom: 1rem;
      }
      .example-box strong {
        color: var(--accent);
        display: block;
        margin-bottom: 0.5rem;
      }
      .example-box p {
        margin: 0.25rem 0;
        color: var(--text);
      }
      .example-box .calc {
        font-weight: 600;
        color: #0d9488;
        margin-top: 0.5rem;
      }
      .example-box .calc strong {
        display: inline;
        color: #0d9488;
      }
      .example-box .tip {
        color: #f59e0b;
        font-weight: 600;
        margin-top: 0.5rem;
      }
      .comparison-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-top: 1.5rem;
      }
      .comparison-grid .result-card {
        background: white;
        border: 2px solid var(--border);
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
      }
      .comparison-grid .result-card h5 {
        color: var(--accent);
        margin: 0 0 0.75rem 0;
      }
      .comparison-grid .result-card .amount {
        font-size: 2rem;
        font-weight: 800;
        font-family: 'SF Mono', Monaco, Consolas, monospace;
        color: var(--text);
      }
      .recommendation-banner {
        grid-column: 1 / -1;
        background: linear-gradient(135deg, var(--accent-light) 0%, rgba(20, 184, 166, 0.05) 100%);
        border: 1px solid var(--accent);
        border-radius: 8px;
        padding: 1rem;
        text-align: center;
        margin-top: 1rem;
      }
      .recommendation-banner strong {
        color: var(--accent);
      }
      .recommendation-banner span {
        color: var(--text);
        font-weight: 600;
      }
      @media (max-width: 768px) {
        .hero h1 {
          font-size: 1.75rem;
        }
        .payment-schedule {
          grid-template-columns: repeat(2, 1fr);
        }
        .method-comparison {
          grid-template-columns: 1fr;
        }
        .method-selector-cards {
          grid-template-columns: 1fr;
        }
        .comparison-grid {
          grid-template-columns: 1fr;
        }
      }
      /* Document Upload Interface Styles */
      .document-upload-container {
        margin-top: 2rem;
      }
      .drop-zone {
        border: 3px dashed var(--border);
        border-radius: var(--radius);
        padding: 3rem 2rem;
        text-align: center;
        background: linear-gradient(135deg, var(--accent-light) 0%, rgba(20, 184, 166, 0.03) 100%);
        transition: all 0.3s;
        cursor: pointer;
      }
      .drop-zone:hover,
      .drop-zone.drag-over {
        border-color: var(--accent);
        background: linear-gradient(135deg, var(--accent-light) 0%, rgba(20, 184, 166, 0.08) 100%);
        transform: scale(1.01);
      }
      .drop-zone-icon {
        font-size: 4rem;
        margin-bottom: 1rem;
      }
      .drop-zone-text {
        font-size: 1.25rem;
        font-weight: 700;
        color: var(--text);
        margin-bottom: 0.5rem;
      }
      .drop-zone-hint {
        color: var(--muted);
        font-size: 0.95rem;
      }
      .camera-capture {
        margin-top: 2rem;
        padding: 2rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        text-align: center;
      }
      .camera-capture video {
        width: 100%;
        max-width: 640px;
        border-radius: var(--radius);
        margin-bottom: 1rem;
      }
      .text-input-zone {
        margin-top: 2rem;
        padding: 1.5rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
      }
      .text-input-zone label {
        display: block;
        font-weight: 600;
        margin-bottom: 0.75rem;
        color: var(--text);
      }
      .processing-status {
        margin-top: 2rem;
        padding: 2rem;
        background: var(--accent-light);
        border: 1px solid var(--accent);
        border-radius: var(--radius);
        text-align: center;
      }
      .spinner {
        border: 4px solid var(--border);
        border-top: 4px solid var(--accent);
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1rem;
      }
      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
      .document-results {
        margin-top: 2rem;
        padding: 1.5rem;
        background: linear-gradient(
          135deg,
          rgba(16, 185, 129, 0.05) 0%,
          rgba(16, 185, 129, 0.02) 100%
        );
        border: 1px solid var(--success);
        border-radius: var(--radius);
      }
      .document-card {
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 1.5rem;
        margin-top: 1rem;
        box-shadow: var(--shadow);
      }
      .document-card-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 0.75rem;
        border-bottom: 1px solid var(--border);
      }
      .document-type {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--accent);
      }
      .confidence-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 999px;
        font-size: 0.875rem;
        font-weight: 600;
      }
      .confidence-high {
        background: rgba(16, 185, 129, 0.1);
        color: var(--success);
      }
      .confidence-medium {
        background: rgba(245, 158, 11, 0.1);
        color: var(--warning);
      }
      .confidence-low {
        background: rgba(239, 68, 68, 0.1);
        color: var(--danger);
      }
      .extracted-fields {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1rem;
      }
      .field-item {
        padding: 0.75rem;
        background: var(--bg);
        border-radius: 6px;
      }
      .field-label {
        font-size: 0.75rem;
        color: var(--muted);
        text-transform: uppercase;
        margin-bottom: 0.25rem;
      }
      .field-value {
        font-size: 1.125rem;
        font-weight: 700;
        color: var(--text);
      }
      .validation-warnings {
        margin-top: 1rem;
        padding: 1rem;
        background: rgba(245, 158, 11, 0.05);
        border: 1px solid var(--warning);
        border-radius: 6px;
      }
      .warning-item {
        display: flex;
        align-items: flex-start;
        gap: 0.5rem;
        margin-top: 0.5rem;
        color: var(--warning);
        font-size: 0.9rem;
      }
      .instructions-box {
        margin-top: 2rem;
        padding: 1.5rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
      }
      .instructions-box h3 {
        margin-bottom: 1rem;
        color: var(--accent);
      }
      .supported-docs-list {
        list-style: none;
        padding: 0;
        margin: 1rem 0;
      }
      .supported-docs-list li {
        padding: 0.5rem 0;
        padding-left: 1.5rem;
        position: relative;
      }
      .supported-docs-list li::before {
        content: '‚úì';
        position: absolute;
        left: 0;
        color: var(--success);
        font-weight: 700;
      }
      .instructions-note {
        margin-top: 1rem;
        padding: 1rem;
        background: rgba(13, 148, 136, 0.05);
        border-left: 4px solid var(--accent);
        border-radius: 4px;
        font-size: 0.9rem;
      }
      /* Footer */
      footer {
        margin-top: 3rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        padding: 1.5rem 2rem;
        text-align: center;
      }
      .footer-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }
      .footer-row {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
      }
      .footer-left {
        display: flex;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .footer-title {
        font-size: 1.125rem;
        font-weight: 700;
        color: #0a7670;
      }
      .footer-subtitle {
        color: var(--muted);
        font-size: 0.85rem;
      }
      .footer-badges {
        display: flex;
        justify-content: center;
        gap: 0.5rem;
        flex-wrap: wrap;
        align-items: center;
      }
      .footer-right {
        display: flex;
        justify-content: center;
        gap: 1rem;
        align-items: center;
        flex-wrap: wrap;
      }
      .footer-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.5rem 1rem;
        background: rgba(10, 118, 112, 0.05);
        border: 1px solid var(--border);
        border-radius: 8px;
        color: var(--text);
        text-decoration: none;
        font-weight: 600;
        transition: all 0.2s;
        font-size: 0.85rem;
      }
      .footer-link:hover {
        border-color: #0a7670;
        color: #0a7670;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(10, 118, 112, 0.15);
      }
      .tech-badge {
        display: inline-block;
        padding: 0.25rem 0.6rem;
        background: rgba(10, 118, 112, 0.08);
        border: 1px solid rgba(10, 118, 112, 0.2);
        border-radius: 6px;
        font-size: 0.7rem;
        color: #0a7670;
        font-weight: 600;
      }
      @media (max-width: 768px) {
        .footer-row {
          flex-direction: column;
          text-align: center;
          align-items: center;
        }
        .footer-left {
          flex-direction: column;
        }
        .footer-badges {
          justify-content: center;
        }
        .footer-right {
          justify-content: center;
        }
      }
      /* Document Upload Styles */
      .drop-zone {
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        padding: 2rem;
        text-align: center;
        background: #fff;
        transition: all 0.3s;
        cursor: pointer;
      }
      .drop-zone:hover {
        border-color: var(--accent);
        background: var(--accent-light);
      }
      .drop-zone p {
        margin: 0.5rem 0;
        color: var(--muted);
      }
      .document-uploader {
        margin-top: 1rem;
      }

      /* Document AI Hub Styling */
      .document-ai-tabs {
        margin-top: 20px;
      }

      .tab-buttons {
        display: flex;
        border-bottom: 2px solid #e0e0e0;
        margin-bottom: 20px;
        gap: 0.5rem;
        flex-wrap: wrap;
      }

      .ai-tab-btn {
        padding: 12px 24px;
        border: none;
        background: transparent;
        cursor: pointer;
        font-size: 16px;
        border-bottom: 3px solid transparent;
        transition: all 0.3s ease;
        color: var(--text);
      }

      .ai-tab-btn:hover {
        background: var(--accent-light);
      }

      .ai-tab-btn.active {
        border-bottom-color: #4a90e2;
        color: #4a90e2;
        font-weight: bold;
      }

      .tab-content-ai {
        margin-top: 1rem;
      }

      .ai-tab-panel {
        display: none;
        animation: fadeIn 0.3s ease;
      }

      .ai-tab-panel.active {
        display: block;
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }

      /* Email Integration Styling */
      .email-integration {
        margin-top: 1.5rem;
      }

      .email-address-box {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
        border-left: 4px solid #4a90e2;
      }

      .email-display {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
        flex-wrap: wrap;
      }

      .email-display code {
        background: #e9ecef;
        padding: 8px 12px;
        border-radius: 4px;
        font-size: 16px;
        font-family: monospace;
        flex: 1;
        min-width: 200px;
      }

      .copy-btn {
        background: #4a90e2;
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 4px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .copy-btn:hover {
        background: #357abd;
      }

      .supported-documents {
        margin-top: 1.5rem;
        padding: 1rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
      }

      .supported-documents ul {
        list-style: none;
        padding: 0;
        margin-top: 0.5rem;
      }

      .supported-documents li {
        padding: 0.5rem 0;
      }

      .email-instructions {
        margin-top: 1.5rem;
        padding: 1rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
      }

      .email-instructions ol {
        margin-top: 0.5rem;
        padding-left: 1.5rem;
      }

      .email-instructions li {
        padding: 0.25rem 0;
      }

      /* Camera Section Styling */
      .camera-section {
        margin-top: 1.5rem;
      }

      .camera-button {
        background: #28a745;
        color: white;
        border: none;
        padding: 15px 30px;
        font-size: 18px;
        border-radius: 8px;
        cursor: pointer;
        margin: 20px 0;
        transition: all 0.2s;
      }

      .camera-button:hover {
        background: #218838;
      }

      .camera-instructions {
        margin-top: 1.5rem;
        padding: 1rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
      }

      .camera-instructions ul {
        list-style: none;
        padding: 0;
        margin-top: 0.5rem;
      }

      .camera-instructions li {
        padding: 0.5rem 0;
      }

      /* Upload Zone Styling */
      .upload-section {
        margin-top: 1.5rem;
      }

      .upload-zone {
        border: 3px dashed #4a90e2;
        border-radius: 8px;
        padding: 40px;
        text-align: center;
        background: #f8f9fa;
        margin: 20px 0;
        transition: all 0.3s ease;
        cursor: pointer;
      }

      .upload-zone:hover {
        background: #e3f2fd;
        border-color: #2196f3;
      }

      .upload-zone.dragover {
        background: #e3f2fd;
        border-color: #2196f3;
        transform: scale(1.01);
      }

      .upload-content {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 1rem;
      }

      .upload-icon {
        font-size: 48px;
        margin-bottom: 10px;
      }

      .upload-btn {
        background: #4a90e2;
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 6px;
        font-size: 16px;
        cursor: pointer;
        margin-top: 10px;
        transition: all 0.2s;
      }

      .upload-btn:hover {
        background: #357abd;
      }

      .upload-info {
        margin-top: 1rem;
        padding: 1rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
      }

      .file-types {
        margin-bottom: 1rem;
      }

      .upload-features ul {
        list-style: none;
        padding: 0;
        margin-top: 0.5rem;
      }

      .upload-features li {
        padding: 0.25rem 0;
      }

      /* Results Section Styling */
      .results-section {
        margin-top: 1.5rem;
      }

      .results-summary {
        padding: 1.5rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
        margin-bottom: 1.5rem;
      }

      .impact-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin: 20px 0;
      }

      .impact-card {
        background: white;
        padding: 20px;
        border-radius: 8px;
        text-align: center;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #4a90e2;
      }

      .impact-card.income {
        border-left-color: #28a745;
      }

      .impact-card.deductions {
        border-left-color: #ffc107;
      }

      .impact-card.savings {
        border-left-color: #17a2b8;
      }

      .impact-label {
        font-size: 14px;
        color: #666;
        margin-bottom: 8px;
      }

      .impact-value {
        font-size: 24px;
        font-weight: bold;
        color: #2c5aa0;
      }

      .processed-documents {
        padding: 1.5rem;
        background: var(--card);
        border: 1px solid var(--border);
        border-radius: 8px;
      }

      .document-list {
        margin-top: 1rem;
      }

      .no-documents {
        text-align: center;
        color: var(--muted);
        padding: 2rem;
      }

      /* Responsive Design */
      @media (max-width: 768px) {
        .tab-buttons {
          flex-wrap: wrap;
        }

        .ai-tab-btn {
          flex: 1;
          min-width: 120px;
        }

        .impact-cards {
          grid-template-columns: 1fr;
        }

        .email-display {
          flex-direction: column;
          align-items: stretch;
        }

        .email-display code {
          flex: auto;
        }
      }
      
      /* Province Selector Styles */
      .province-selector-bar {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding: 1rem;
        background: linear-gradient(135deg, #0d9488 0%, #0f766e 100%);
        color: white;
        border-radius: 8px;
        margin-bottom: 2rem;
      }

      .province-dropdown {
        padding: 0.5rem 1rem;
        font-size: 1rem;
        border: 2px solid white;
        border-radius: 6px;
        background: white;
        color: #0f766e;
        cursor: pointer;
        font-weight: 600;
        min-width: 200px;
      }

      .province-dropdown:focus {
        outline: none;
        box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
      }

      .province-flag {
        font-size: 2rem;
      }
      
      .province-specific {
        display: none;
      }
      
      .province-specific.qc-only {
        display: block; /* Quebec is default province */
      }
      
      .province-specific.bc-only {
        display: none; /* Shown when BC province selected */
      }
      
      .province-specific.ab-only {
        display: none; /* Shown when AB province selected */
      }
      
      /* Ontario Trillium specific styles */
      .info-banner {
        background: linear-gradient(135deg, rgba(13, 148, 136, 0.1) 0%, rgba(20, 184, 166, 0.05) 100%);
        border: 1px solid var(--accent);
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 2rem;
      }
      
      .info-banner strong {
        color: var(--accent);
      }
      
      .info-banner ul {
        margin: 0.5rem 0 0.5rem 1.5rem;
      }
      
      .form-section {
        margin-bottom: 2rem;
      }
      
      .form-section h4 {
        margin-bottom: 1rem;
        color: var(--accent);
      }
      
      .summary-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 1rem;
        margin-top: 1.5rem;
      }
      
      .summary-card {
        background: white;
        padding: 1.5rem;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        text-align: center;
        border: 2px solid var(--border);
      }
      
      .summary-card.highlight {
        border-color: var(--accent);
        background: linear-gradient(135deg, var(--accent-light) 0%, rgba(20, 184, 166, 0.05) 100%);
      }
      
      .summary-card.payment-info {
        border-color: var(--success);
      }
      
      .summary-card h5 {
        font-size: 0.875rem;
        color: var(--muted);
        margin-bottom: 0.5rem;
        text-transform: uppercase;
      }
      
      .big-number {
        font-size: 2rem;
        font-weight: 800;
        color: var(--accent);
        margin: 0.5rem 0;
      }
      
      .summary-card small {
        font-size: 0.875rem;
        color: var(--muted);
      }
      
      .results-section {
        margin-top: 2rem;
      }
    </style>
    
    <!-- PDF.js Library for PDF text extraction -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
      // Configure PDF.js worker
      if (typeof pdfjsLib !== 'undefined') {
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
      }
    </script>
  </head>
  <body>
    <header>
      <div class="container">
        <div class="header-content">
          <a href="#" class="logo"
            ><span>üöó</span><span>TaxSyncForDrivers</span
            ><span class="badge" id="current-year"></span
          ></a>
          <div class="lang-toggle">
            <button class="lang-btn active" onclick="setLang('fr')">FR</button
            ><button class="lang-btn" onclick="setLang('en')">EN</button>
          </div>
        </div>
      </div>
    </header>
    <main class="container">
      <section class="hero">
        <h1 data-i18n="hero.title">Planification fiscale pour chauffeurs</h1>
        <p data-i18n="hero.subtitle">
          Maximisez vos d√©ductions, planifiez vos acomptes trimestriels et gardez plus d'argent dans
          vos poches.
        </p>
        <div class="hero-stats">
          <div class="hero-stat">
            <div class="hero-stat-value">$0.70</div>
            <div class="hero-stat-label" data-i18n="hero.perKm">/km d√©ductible</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-value">$3,000+</div>
            <div class="hero-stat-label" data-i18n="hero.savings">√©conomies potentielles</div>
          </div>
          <div class="hero-stat">
            <div class="hero-stat-value">100%</div>
            <div class="hero-stat-label" data-i18n="hero.private">priv√© et gratuit</div>
          </div>
        </div>
      </section>
      
      <!-- Province Selector Bar -->
      <div class="province-selector-bar">
        <label for="provinceSelect">
          <span data-i18n="province.label">Votre province:</span>
        </label>
        <select id="provinceSelect" class="province-dropdown">
          <!-- Options populated dynamically by updateProvinceDropdown() -->
        </select>
        
        <span class="province-flag" id="provinceFlagIcon">üá®üá¶</span>
      </div>
      
      <!-- GST/HST Registration Warning Banner -->
      <div id="gstHstWarning" class="alert alert-warning" style="display:none; margin: 1rem 0; padding: 1.5rem; background-color: #fff3cd; border: 2px solid #ffc107; border-radius: 12px;">
        <h4 style="margin-top: 0; color: #856404;">‚ö†Ô∏è GST/HST Registration Alert</h4>
        <p id="gstWarningMessage" style="margin-bottom: 1rem;"></p>
        <a href="https://www.canada.ca/en/revenue-agency/services/tax/businesses/topics/gst-hst-businesses/register.html" 
           target="_blank" 
           class="btn" 
           style="display: inline-block; background: var(--accent); color: white; padding: 0.5rem 1rem; text-decoration: none; border-radius: 8px;">
          Learn About GST/HST Registration
        </a>
      </div>
      
      <nav class="tabs">
        <button class="tab-btn active" data-tab="vehicle">
          <span class="tab-icon">üöô</span
          ><span class="tab-label" data-i18n="tabs.vehicle">D√©penses v√©hicule</span>
        </button>
        <button class="tab-btn" data-tab="documentAI">
          <span class="tab-icon">ü§ñ</span
          ><span class="tab-label" data-i18n="tabs.documentAI">Document AI</span>
        </button>
        <button class="tab-btn" data-tab="homeOffice">
          <span class="tab-icon">üè†</span
          ><span class="tab-label" data-i18n="tabs.homeOffice">Bureau √† domicile</span>
        </button>
        <button class="tab-btn" data-tab="quarterly">
          <span class="tab-icon">üìÖ</span
          ><span class="tab-label" data-i18n="tabs.quarterly">Acomptes trimestriels</span>
        </button>
        <button class="tab-btn" data-tab="selfemploy">
          <span class="tab-icon">üíº</span
          ><span class="tab-label" data-i18n="tabs.selfemploy">RRQ travailleur autonome</span>
        </button>
        <button class="tab-btn" data-tab="businessExpenses">
          <span class="tab-icon">üìä</span
          ><span class="tab-label" data-i18n="tabs.businessExpenses">Business Expenses</span>
        </button>
        <button class="tab-btn" data-tab="medical">
          <span class="tab-icon">üíä</span
          ><span class="tab-label" data-i18n="tabs.medical">Medical Expenses</span>
        </button>
        <button class="tab-btn" data-tab="childcare">
          <span class="tab-icon">üë∂</span
          ><span class="tab-label" data-i18n="tabs.childcare">Childcare</span>
        </button>
        <button class="tab-btn" data-tab="donations">
          <span class="tab-icon">‚ù§Ô∏è</span
          ><span class="tab-label" data-i18n="tabs.donations">Charitable Donations</span>
        </button>
        <button class="tab-btn province-specific on-only" data-tab="ontarioTrillium" style="display:none;">
          <span class="tab-icon">üí∞</span
          ><span class="tab-label" data-i18n="tabs.ontarioTrillium">Ontario Trillium</span>
        </button>
        <button class="tab-btn province-specific bc-only" data-tab="bcClimateAction" style="display:none;">
          <span class="tab-icon">üå±</span
          ><span class="tab-label" data-i18n="tabs.bcClimateAction">BC Climate Action</span>
        </button>
        <button class="tab-btn province-specific bc-only" data-tab="bcAffordability" style="display:none;">
          <span class="tab-icon">üí∞</span
          ><span class="tab-label" data-i18n="tabs.bcAffordability">BC Affordability</span>
        </button>
        <button class="tab-btn province-specific bc-only" data-tab="bcHomeOwner" style="display:none;">
          <span class="tab-icon">üè†</span
          ><span class="tab-label" data-i18n="tabs.bcHomeOwner">BC Home Owner Grant</span>
        </button>
        <button class="tab-btn province-specific mb-only sk-only ns-only nb-only pe-only nl-only yt-only nt-only nu-only" data-tab="universalProvincial" style="display:none;">
          <span class="tab-icon">üìä</span
          ><span class="tab-label" data-i18n="tabs.universalProvincial">Provincial Tax</span>
        </button>
        <button class="tab-btn province-specific yt-only nt-only nu-only" data-tab="northernResidents" style="display:none;">
          <span class="tab-icon">üèîÔ∏è</span
          ><span class="tab-label" data-i18n="tabs.northernResidents">Northern Residents</span>

        <button class="tab-btn province-specific ab-only" data-tab="albertaChildBenefit" style="display:none;">
          <span class="tab-icon">üë∂</span
          ><span class="tab-label" data-i18n="tabs.albertaChildBenefit">AB Child Benefit</span>
        </button>
        <button class="tab-btn province-specific ab-only" data-tab="albertaSeniors" style="display:none;">
          <span class="tab-icon">üë¥</span
          ><span class="tab-label" data-i18n="tabs.albertaSeniors">AB Seniors Benefit</span>
        </button>
        <button class="tab-btn province-specific ab-only" data-tab="albertaEmploymentCredit" style="display:none;">
          <span class="tab-icon">üíº</span
          ><span class="tab-label" data-i18n="tabs.albertaEmploymentCredit">AB Employment Credit</span>
        </button>
        <button class="tab-btn province-specific ab-only" data-tab="albertaTaxSummary" style="display:none;">
          <span class="tab-icon">üìä</span
          ><span class="tab-label" data-i18n="tabs.albertaTaxSummary">AB Tax Advantage</span>
        </button>
      </nav>
      <section id="vehicle" class="tab-content active">
        <h2>üöô <span data-i18n="vehicle.title">Optimiseur de d√©penses v√©hicule</span></h2>
        <p data-i18n="vehicle.description">
          Comparez la m√©thode simplifi√©e (par km) et d√©taill√©e pour maximiser vos d√©ductions.
        </p>
        <fieldset>
          <legend data-i18n="vehicle.simplified">M√©thode simplifi√©e</legend>
          <div class="form-group">
            <label for="totalKm" data-i18n="vehicle.totalKm"
              >Kilom√®tres d'affaires total (ann√©e)</label
            >
            <input type="number" id="totalKm" placeholder="ex: 25000" min="0" />
            <span class="label-hint" data-i18n="vehicle.kmHint"
              >Utilisez un journal de bord ou l'app Uber/Lyft</span
            >
          </div>
        </fieldset>
        
        <!-- Odometer Tracking Section -->
        <fieldset style="margin-bottom: 2rem;">
          <legend>üöó Vehicle Odometer Tracking (CRA Required)</legend>
          <p style="color: var(--muted); font-size: 0.9rem; margin-bottom: 1rem;">
            CRA requires odometer readings to support vehicle expense deductions.
          </p>
          
          <div class="form-grid">
            <div class="form-group">
              <label for="odometerStart">Start of Year Odometer (km)</label>
              <input type="number" id="odometerStart" placeholder="e.g., 45000" min="0" />
              <small>Odometer reading on January 1, 2026</small>
            </div>
            
            <div class="form-group">
              <label for="odometerEnd">Current/End of Year Odometer (km)</label>
              <input type="number" id="odometerEnd" placeholder="e.g., 72000" min="0" />
              <small>Current or December 31, 2026 reading</small>
            </div>
          </div>
          
          <div class="form-group">
            <label for="businessKmInput">Business Kilometers (km)</label>
            <input type="number" id="businessKmInput" placeholder="Calculated from trips or manual entry" min="0" />
            <small>Total km driven for business purposes this year</small>
          </div>
          
          <div class="btn-group">
            <button class="btn btn-secondary" onclick="calculateOdometer()">Calculate Total KM</button>
          </div>
          
          <div id="odometerSummary" class="result-box" style="display:none; margin-top: 1rem; padding: 1rem; background: var(--accent-light); border-radius: 8px;">
            <strong>üìä Odometer Summary:</strong>
            <p style="margin: 0.5rem 0;">Total KM Driven: <strong><span id="totalKmDriven">0</span> km</strong></p>
            <p style="margin: 0.5rem 0;">Business KM: <strong><span id="businessKmPercent">0</span> km</strong> (<span id="businessPercent">0</span>%)</p>
            <p style="margin: 0.5rem 0;">Personal KM: <strong><span id="personalKm">0</span> km</strong></p>
          </div>
        </fieldset>
        
        <div class="toggle-container">
          <label class="toggle"
            ><input type="checkbox" id="showDetailed" aria-labelledby="vehicleShowDetailedLabel" /><span class="toggle-slider"></span
          ></label>
          <span id="vehicleShowDetailedLabel" data-i18n="vehicle.showDetailed">Afficher m√©thode d√©taill√©e</span>
        </div>
        <fieldset id="detailedSection" style="display: none">
          <legend data-i18n="vehicle.detailed">M√©thode d√©taill√©e (d√©penses r√©elles)</legend>
          <div class="form-grid">
            <div class="form-group">
              <label for="fuel" data-i18n="vehicle.fuel">Essence / √âlectricit√© ($)</label
              ><input type="number" id="fuel" placeholder="0" min="0" />
            </div>
            <div class="form-group">
              <label for="insurance" data-i18n="vehicle.insurance">Assurance ($)</label
              ><input type="number" id="insurance" placeholder="0" min="0" />
            </div>
            <div class="form-group">
              <label for="maintenance" data-i18n="vehicle.maintenance"
                >Entretien / R√©parations ($)</label
              ><input type="number" id="maintenance" placeholder="0" min="0" />
            </div>
            <div class="form-group">
              <label for="businessPercent" data-i18n="vehicle.businessPercent"
                >% utilisation affaires</label
              ><input type="number" id="businessPercent" value="80" min="0" max="100" />
            </div>
          </div>
        </fieldset>
        <div class="btn-group">
          <button class="btn" onclick="calculateVehicle()" data-i18n="vehicle.calculate">
            Calculer mes d√©ductions
          </button>
          <button class="btn btn-secondary" onclick="resetVehicle()" data-i18n="common.reset">
            R√©initialiser
          </button>
        </div>
        <div id="vehicleResults" class="result-box" style="display: none">
          <div class="result-title">
            üìä <span data-i18n="vehicle.results">R√©sultats de l'analyse</span>
          </div>
          <div class="method-comparison">
            <div class="method-card" id="simplifiedCard">
              <h4 data-i18n="vehicle.simplifiedMethod">M√©thode simplifi√©e</h4>
              <div class="amount" id="simplifiedAmount">$0</div>
              <div id="simplifiedBadge"></div>
            </div>
            <div class="method-card" id="detailedCard">
              <h4 data-i18n="vehicle.detailedMethod">M√©thode d√©taill√©e</h4>
              <div class="amount" id="detailedAmount">$0</div>
              <div id="detailedBadge"></div>
            </div>
          </div>
          <div class="savings-summary">
            <div class="savings-amount" id="vehicleSavings">$0</div>
            <div class="savings-label" data-i18n="vehicle.totalDeduction">
              D√©duction totale recommand√©e
            </div>
          </div>
        </div>
      </section>
      <section id="documentAI" class="tab-content">
        <h2>ü§ñ <span data-i18n="documentAI.title">Document AI Hub</span></h2>
        <p data-i18n="documentAI.subtitle">
          Process tax documents automatically using email, camera, or upload
        </p>

        <div class="document-ai-tabs">
          <div class="tab-buttons">
            <button class="ai-tab-btn active" data-tab="email">
              üìß <span data-i18n="documentAI.email">Email</span>
            </button>
            <button class="ai-tab-btn" data-tab="camera">
              üì± <span data-i18n="documentAI.camera">Camera</span>
            </button>
            <button class="ai-tab-btn" data-tab="upload">
              üíª <span data-i18n="documentAI.upload">Upload</span>
            </button>
            <button class="ai-tab-btn" data-tab="results">
              üìä <span data-i18n="documentAI.results">Results</span>
            </button>
          </div>

          <div class="tab-content-ai">
            <!-- Email Processing Tab -->
            <div id="email" class="ai-tab-panel active">
              <h3>üìß <span data-i18n="documentAI.emailTitle">Email Processing</span></h3>
              <div class="email-integration">
                <div class="email-address-box">
                  <label data-i18n="documentAI.forwardTo">Forward tax documents to:</label>
                  <div class="email-display">
                    <code>notifications@isaloumapps.com</code>
                    <button onclick="copyEmailAddress(event)" class="copy-btn">
                      üìã <span data-i18n="documentAI.copy">Copy</span>
                    </button>
                  </div>
                </div>

                <div class="supported-documents">
                  <h4 data-i18n="documentAI.supported">Supported Documents:</h4>
                  <ul>
                    <li>
                      üìä <span data-i18n="documentAI.uberLyft">Uber/Lyft weekly summaries</span>
                    </li>
                    <li>‚õΩ <span data-i18n="documentAI.gas">Gas station receipts</span></li>
                    <li>üìÑ <span data-i18n="documentAI.t4">T4/RL-1 tax slips</span></li>
                    <li>
                      üîß
                      <span data-i18n="documentAI.maintenance">Vehicle maintenance receipts</span>
                    </li>
                    <li>üì± <span data-i18n="documentAI.phone">Phone bills</span></li>
                    <li>üè¢ <span data-i18n="documentAI.insurance">Insurance documents</span></li>
                  </ul>
                </div>

                <div class="email-instructions">
                  <h4 data-i18n="documentAI.howItWorks">How it works:</h4>
                  <ol>
                    <li data-i18n="documentAI.step1">Forward any tax document via email</li>
                    <li data-i18n="documentAI.step2">
                      AI extracts data automatically (30 seconds)
                    </li>
                    <li data-i18n="documentAI.step3">Receive confirmation with tax impact</li>
                    <li data-i18n="documentAI.step4">Calculator updates automatically</li>
                  </ol>
                </div>
              </div>
            </div>

            <!-- Camera Capture Tab -->
            <div id="camera" class="ai-tab-panel">
              <h3>üì± <span data-i18n="documentAI.mobileScanner">Mobile Scanner</span></h3>
              <div class="camera-section">
                <button id="cameraBtn" class="camera-button" onclick="startCamera()">
                  üì∑ <span data-i18n="documentAI.scanReceipt">Scan Receipt</span>
                </button>
                <video
                  id="cameraPreview"
                  style="display: none"
                  width="100%"
                  autoplay
                  playsinline
                ></video>
                <canvas id="captureCanvas" style="display: none"></canvas>

                <div class="camera-instructions">
                  <h4 data-i18n="documentAI.scannerFeatures">Scanner Features:</h4>
                  <ul>
                    <li>
                      üì∏ <span data-i18n="documentAI.instantPhoto">Instant photo capture</span>
                    </li>
                    <li>
                      üîç <span data-i18n="documentAI.realtimeOCR">Real-time OCR processing</span>
                    </li>
                    <li>
                      üí∞
                      <span data-i18n="documentAI.immediateTax"
                        >Immediate tax impact calculation</span
                      >
                    </li>
                    <li>
                      üì± <span data-i18n="documentAI.worksMobile">Works on mobile devices</span>
                    </li>
                  </ul>
                </div>
              </div>
            </div>

            <!-- Upload Tab -->
            <div id="upload" class="ai-tab-panel">
              <h3>üíª <span data-i18n="documentAI.documentUpload">Document Upload</span></h3>
              <div class="upload-section">
                <div style="background: #d1f2eb; padding: 1rem; border-radius: 8px; margin-bottom: 1rem; border-left: 4px solid #10b981;">
                  <strong>‚úÖ PDF Support Enabled!</strong> You can now upload PDF files. Text will be automatically extracted and processed.
                  <br><small style="color: #64748b; margin-top: 0.5rem; display: block;">Note: Image-based PDFs (scanned documents) cannot be processed yet. Please use the "Paste Text" option for those.</small>
                </div>
                <div class="upload-zone" id="uploadZone">
                  <div class="upload-content">
                    <div class="upload-icon">üìÑ</div>
                    <p data-i18n="documentAI.dragDrop">
                      Drag & Drop documents here or click to browse
                    </p>
                    <button class="upload-btn" onclick="triggerFileSelect()">
                      <span data-i18n="documentAI.chooseFiles">Choose Files</span>
                    </button>
                    <input
                      type="file"
                      id="fileInput"
                      multiple
                      accept="image/*,text/plain,application/pdf,.pdf"
                      style="display: none"
                    />
                  </div>
                </div>

                <div class="upload-info">
                  <div class="file-types">
                    <strong data-i18n="documentAI.supportedFormats">Supported formats:</strong> <strong style="color: var(--success);">PDF</strong>, Images (JPG, PNG, GIF, WebP), Text files (TXT)
                  </div>
                  <div class="upload-features">
                    <ul>
                      <li>
                        ‚úÖ <span data-i18n="documentAI.multipleFiles">Multiple file upload</span>
                      </li>
                      <li>
                        ‚úÖ <span data-i18n="documentAI.batchProcessing">Batch processing</span>
                      </li>
                      <li>
                        ‚úÖ <span data-i18n="documentAI.progressTracking">Progress tracking</span>
                      </li>
                      <li>
                        ‚úÖ <span data-i18n="documentAI.secureProcessing">Secure processing</span>
                      </li>
                    </ul>
                  </div>
                </div>

                <!-- Text Input Fallback -->
                <div class="text-input-zone">
                  <label for="documentText" data-i18n="documentAI.textLabel">
                    Or paste document text here:
                  </label>
                  <textarea
                    id="documentText"
                    rows="6"
                    data-i18n-placeholder="documentAI.textPlaceholder"
                  ></textarea>
                  <button class="btn" onclick="processDocumentText()" style="margin-top: 0.5rem">
                    üîç <span data-i18n="documentAI.processText">Process Text</span>
                  </button>
                </div>
              </div>
            </div>

            <!-- Results Tab -->
            <div id="results" class="ai-tab-panel">
              <h3>üìä <span data-i18n="documentAI.processingResults">Processing Results</span></h3>
              <div class="results-section">
                <div class="results-summary">
                  <h4 data-i18n="documentAI.taxImpact">Tax Impact Summary</h4>
                  <div class="impact-cards">
                    <div class="impact-card income">
                      <div class="impact-label" data-i18n="documentAI.incomeAdded">
                        Income Added
                      </div>
                      <div class="impact-value" id="totalIncome">$0</div>
                    </div>
                    <div class="impact-card deductions">
                      <div class="impact-label" data-i18n="documentAI.deductionsAdded">
                        Deductions Added
                      </div>
                      <div class="impact-value" id="totalDeductions">$0</div>
                    </div>
                    <div class="impact-card savings">
                      <div class="impact-label" data-i18n="documentAI.taxSavings">Tax Savings</div>
                      <div class="impact-value" id="totalSavings">$0</div>
                    </div>
                  </div>
                  <div style="margin-top: 0.5rem; text-align: center;">
                    <button 
                      onclick="updateTaxImpactSummary()" 
                      style="padding: 0.5rem 1rem; background: var(--accent); color: white; border: none; border-radius: 6px; cursor: pointer; font-size: 0.875rem; font-weight: 600;">
                      üîÑ Recalculate
                    </button>
                  </div>
                </div>

                <!-- Processing Status -->
                <div id="processingStatus" style="display: none">
                  <div class="result-box" style="text-align: center">
                    <div class="result-title">
                      <span id="statusIcon">‚è≥</span>
                      <span id="statusText" data-i18n="documentAI.processing">Processing...</span>
                    </div>
                  </div>
                </div>

                <!-- Document Results Display (Individual Result) -->
                <div id="documentResults" style="display: none">
                  <div class="document-card" style="background: #fff; border: 1px solid var(--border); border-radius: 8px; padding: 1.5rem; margin-top: 1rem; box-shadow: var(--shadow);">
                    
                    <!-- Document Header -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem; padding-bottom: 0.75rem; border-bottom: 1px solid var(--border);">
                      <div id="docType" style="font-size: 1.125rem; font-weight: 700; color: var(--accent);"></div>
                      <div id="docConfidence" style="padding: 0.25rem 0.75rem; border-radius: 999px; font-size: 0.875rem; font-weight: 600; background: rgba(16, 185, 129, 0.1); color: var(--success);"></div>
                    </div>
                    
                    <!-- Extracted Data -->
                    <div>
                      <h4 style="margin-bottom: 0.5rem;">Extracted Data:</h4>
                      <pre id="extractedData" style="background: var(--bg); padding: 1rem; border-radius: 6px; overflow-x: auto; font-size: 0.875rem;"></pre>
                    </div>
                    
                    <!-- Category Info -->
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid var(--border);">
                      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <div>
                          <div style="font-size: 0.75rem; color: var(--muted); text-transform: uppercase;">Category</div>
                          <div id="categoryName" style="font-size: 1.125rem; font-weight: 700;"></div>
                        </div>
                        <div>
                          <div id="amountLabel" style="font-size: 0.75rem; color: var(--muted); text-transform: uppercase;">Amount</div>
                          <div id="categoryAmount" style="font-size: 1.125rem; font-weight: 700; color: var(--accent);"></div>
                        </div>
                        <div id="deductionItem" style="display: none;">
                          <div style="font-size: 0.75rem; color: var(--muted); text-transform: uppercase;">Deductible Amount</div>
                          <div id="deductibleAmount" style="font-size: 1.125rem; font-weight: 700; color: var(--success);"></div>
                        </div>
                        <div id="savingsItem" style="display: none;">
                          <div style="font-size: 0.75rem; color: var(--muted); text-transform: uppercase;">Tax Savings</div>
                          <div id="taxSavings" style="font-size: 1.125rem; font-weight: 700; color: var(--success);"></div>
                        </div>
                      </div>
                    </div>
                    
                    <!-- Warnings -->
                    <div id="warningsSection" style="display: none; margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.05); border: 1px solid var(--warning); border-radius: 6px;">
                      <div style="font-weight: 600; color: var(--warning); margin-bottom: 0.5rem;">‚ö†Ô∏è Warnings</div>
                      <ul id="warningsList" style="margin: 0.5rem 0 0 1.5rem; color: var(--warning);"></ul>
                    </div>

                    <!-- T4A Display Card -->
                    <div id="t4aCard" style="display: none; margin-top: 1rem; padding: 1.5rem; background: var(--bg); border: 1px solid var(--border); border-radius: 8px;">
                      <h4 style="margin-bottom: 1rem; color: var(--accent);">üìÑ T4A - Statement of Contractor Payments</h4>
                      <div style="display: grid; gap: 0.75rem;">
                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 0.5rem;">
                          <div style="font-weight: 600;">Payer Name:</div>
                          <div id="t4aPayerName"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 0.5rem;">
                          <div style="font-weight: 600;">Box 048 - Fees for Services:</div>
                          <div id="t4aBox048" style="color: var(--accent);"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 0.5rem;">
                          <div style="font-weight: 600;">Box 020 - Commissions:</div>
                          <div id="t4aBox020" style="color: var(--accent);"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 0.5rem;">
                          <div style="font-weight: 600;">Box 028 - Other Income:</div>
                          <div id="t4aBox028" style="color: var(--accent);"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 0.5rem; padding-top: 0.5rem; border-top: 1px solid var(--border); margin-top: 0.5rem;">
                          <div style="font-weight: 700; font-size: 1.125rem;">Total Income:</div>
                          <div id="t4aTotalIncome" style="font-weight: 700; font-size: 1.125rem; color: var(--accent);"></div>
                        </div>
                        <div style="display: grid; grid-template-columns: 200px 1fr; gap: 0.5rem;">
                          <div style="font-weight: 600;">Box 022 - Tax Deducted:</div>
                          <div id="t4aBox022" style="color: var(--success);"></div>
                        </div>
                      </div>
                      <div style="margin-top: 1rem; padding: 1rem; background: rgba(10, 118, 112, 0.05); border: 1px solid var(--accent); border-radius: 6px;">
                        <div style="font-weight: 600; color: var(--accent); margin-bottom: 0.5rem;">‚ÑπÔ∏è Important</div>
                        <p style="font-size: 0.875rem; margin: 0;">T4A income is self-employment income. You can deduct business expenses against this income to reduce your taxable amount. Use the Business Expenses tab to track your deductible expenses.</p>
                      </div>
                    </div>
                    
                  </div>
                </div>

                <!-- Document Results Display (History) -->
                <div id="documentResultsDisplay" class="processed-documents">
                  <h4 data-i18n="documentAI.processedDocs">Processed Documents</h4>
                  <div id="documentHistory" class="document-list">
                    <p class="no-documents" data-i18n="documentAI.noDocs">
                      No documents processed yet
                    </p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section id="homeOffice" class="tab-content">
        <h2>üè† <span data-i18n="homeOffice.title">Calculateur Bureau √† domicile</span></h2>
        <p data-i18n="homeOffice.subtitle">
          Comparez les m√©thodes simplifi√©e et d√©taill√©e pour maximiser vos d√©ductions
        </p>

        <div class="method-selector-cards">
          <label class="method-card" for="homeOfficeSimplified">
            <input type="radio" name="homeOfficeMethod" id="homeOfficeSimplified" value="simplified" checked onchange="toggleHomeOfficeMethod()">
            <div class="card-content">
              <h4 data-i18n="homeOffice.simplifiedCardTitle">üìÖ M√©thode simplifi√©e</h4>
              <span class="highlight" data-i18n="homeOffice.simplifiedHighlight">2$ par jour travaill√©</span>
              <span class="limit" data-i18n="homeOffice.simplifiedLimit">Maximum: 500$/an</span>
              <ul class="benefits">
                <li data-i18n="homeOffice.simplifiedBenefit1">‚úÖ Aucun re√ßu requis</li>
                <li data-i18n="homeOffice.simplifiedBenefit2">‚úÖ Calcul rapide</li>
                <li data-i18n="homeOffice.simplifiedBenefit3">‚úÖ Id√©al pour t√©l√©travail occasionnel</li>
              </ul>
            </div>
          </label>
          
          <label class="method-card" for="homeOfficeDetailed">
            <input type="radio" name="homeOfficeMethod" id="homeOfficeDetailed" value="detailed" onchange="toggleHomeOfficeMethod()">
            <div class="card-content">
              <h4 data-i18n="homeOffice.detailedCardTitle">üßæ M√©thode d√©taill√©e</h4>
              <span class="highlight" data-i18n="homeOffice.detailedHighlight">Bas√©e sur vos d√©penses r√©elles</span>
              <span class="limit" data-i18n="homeOffice.detailedLimit">D√©duction plus √©lev√©e possible</span>
              <ul class="benefits">
                <li data-i18n="homeOffice.detailedBenefit1">‚úÖ Maximise votre remboursement</li>
                <li data-i18n="homeOffice.detailedBenefit2">‚ö†Ô∏è Re√ßus requis (loyer, √©lectricit√©, etc.)</li>
                <li data-i18n="homeOffice.detailedBenefit3">‚ö†Ô∏è Mesures de bureau n√©cessaires</li>
              </ul>
            </div>
          </label>
        </div>

        <!-- Help Section with Examples -->
        <div class="help-section">
          <h5 data-i18n="homeOffice.helpTitle">üí° Quelle m√©thode choisir?</h5>
          
          <div class="example-box">
            <strong data-i18n="homeOffice.exampleSimplifiedTitle">Exemple - M√©thode simplifi√©e:</strong>
            <p data-i18n="homeOffice.exampleSimplifiedText">Vous travaillez de la maison 200 jours par ann√©e.</p>
            <p class="calc"><span data-i18n="homeOffice.exampleSimplifiedCalc">200 jours √ó 2$ = </span><strong data-i18n="homeOffice.exampleSimplifiedResult">400$ de d√©duction</strong></p>
          </div>
          
          <div class="example-box">
            <strong data-i18n="homeOffice.exampleDetailedTitle">Exemple - M√©thode d√©taill√©e:</strong>
            <p data-i18n="homeOffice.exampleDetailedText1">Bureau: 150 pi¬≤ / Maison totale: 1,200 pi¬≤ = 12.5%</p>
            <p data-i18n="homeOffice.exampleDetailedText2">D√©penses annuelles: 24,000$ (loyer, √©lectricit√©, etc.)</p>
            <p class="calc"><span data-i18n="homeOffice.exampleDetailedCalc">24,000$ √ó 12.5% = </span><strong data-i18n="homeOffice.exampleDetailedResult">3,000$ de d√©duction</strong></p>
            <p class="tip" data-i18n="homeOffice.exampleDetailedTip">‚ö° √âconomie de 2,600$ vs. m√©thode simplifi√©e!</p>
          </div>
        </div>

        <!-- Simplified Method Fields -->
        <div id="homeOfficeSimplifiedFields">
          <fieldset>
            <legend data-i18n="homeOffice.simplifiedTitle">M√©thode simplifi√©e</legend>
            <div class="form-group">
              <label for="workDaysHome" data-i18n="homeOffice.workDays">Jours travaill√©s √† domicile:</label>
              <input type="number" id="workDaysHome" value="200" min="0" max="250" />
              <small data-i18n="homeOffice.maxDays">Maximum 250 jours par ann√©e</small>
            </div>
          </fieldset>
        </div>

        <!-- Detailed Method Fields -->
        <div id="homeOfficeDetailedFields" style="display:none;">
          <fieldset>
            <legend data-i18n="homeOffice.workspaceDimensions">Dimensions de l'espace de travail</legend>
            <div class="form-grid">
              <div class="form-group">
                <label for="workspaceArea" data-i18n="homeOffice.workspaceArea">Superficie du bureau (pi¬≤):</label>
                <input type="number" id="workspaceArea" value="150" min="0" />
              </div>
              <div class="form-group">
                <label for="totalHomeArea" data-i18n="homeOffice.totalHomeArea">Superficie totale du domicile (pi¬≤):</label>
                <input type="number" id="totalHomeArea" value="1200" min="0" />
              </div>
            </div>
          </fieldset>

          <fieldset>
            <legend data-i18n="homeOffice.annualExpenses">D√©penses annuelles</legend>
            <div class="form-grid">
              <div class="form-group">
                <label for="expenseRent" data-i18n="homeOffice.rent">Loyer (si locataire) ($):</label>
                <input type="number" id="expenseRent" value="0" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="expenseMortgage" data-i18n="homeOffice.mortgage">Int√©r√™ts hypoth√©caires (si propri√©taire) ($):</label>
                <input type="number" id="expenseMortgage" value="0" min="0" step="0.01" />
                <small data-i18n="homeOffice.mortgageNote">Int√©r√™ts seulement, pas le capital!</small>
              </div>
              <div class="form-group">
                <label for="expensePropertyTax" data-i18n="homeOffice.propertyTax">Taxe fonci√®re ($):</label>
                <input type="number" id="expensePropertyTax" value="0" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="expenseHomeInsurance" data-i18n="homeOffice.homeInsurance">Assurance habitation ($):</label>
                <input type="number" id="expenseHomeInsurance" value="0" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="expenseUtilities" data-i18n="homeOffice.utilities">Services publics (chauffage, √©lectricit√©, eau) ($):</label>
                <input type="number" id="expenseUtilities" value="0" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="expenseMaintenance" data-i18n="homeOffice.maintenance">Entretien et r√©parations ($):</label>
                <input type="number" id="expenseMaintenance" value="0" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="expenseCondoFees" data-i18n="homeOffice.condoFees">Frais de condo ($):</label>
                <input type="number" id="expenseCondoFees" value="0" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="expenseInternet" data-i18n="homeOffice.internet">Internet ($):</label>
                <input type="number" id="expenseInternet" value="0" min="0" step="0.01" />
              </div>
              <div class="form-group">
                <label for="expensePhone" data-i18n="homeOffice.phone">T√©l√©phone ($):</label>
                <input type="number" id="expensePhone" value="0" min="0" step="0.01" />
              </div>
            </div>
          </fieldset>

          <div class="form-group">
            <label for="netBusinessIncome" data-i18n="homeOffice.netIncome">Revenu net d'entreprise (avant d√©duction du bureau) ($):</label>
            <input type="number" id="netBusinessIncome" value="50000" min="0" step="0.01" />
            <small data-i18n="homeOffice.incomeNote">La d√©duction ne peut exc√©der ce montant</small>
          </div>
        </div>

        <div class="btn-group">
          <button class="btn" onclick="calculateHomeOffice()" data-i18n="homeOffice.calculate">
            Calculer ma d√©duction
          </button>
          <button class="btn btn-secondary" onclick="compareBothHomeOfficeMethods()" data-i18n="homeOffice.compareBoth">
            üîÑ Comparer les deux m√©thodes
          </button>
          <button class="btn btn-secondary" onclick="resetHomeOffice()" data-i18n="common.reset">
            R√©initialiser
          </button>
        </div>

        <div id="homeOfficeResults" class="result-box" style="display:none; margin-top:2rem;">
          <div class="result-title">
            üìä <span data-i18n="homeOffice.results">R√©sultats du calcul</span>
          </div>
          <div class="method-comparison" id="homeOfficeComparison" style="display:none;">
            <div class="method-card">
              <h4 data-i18n="homeOffice.simplifiedMethod">M√©thode simplifi√©e</h4>
              <div class="amount" id="homeOfficeSimplifiedAmount">$0</div>
              <div id="homeOfficeSimplifiedBreakdown" style="font-size: 0.875rem; color: var(--muted); margin-top: 0.5rem;"></div>
            </div>
            <div class="method-card">
              <h4 data-i18n="homeOffice.detailedMethod">M√©thode d√©taill√©e</h4>
              <div class="amount" id="homeOfficeDetailedAmount">$0</div>
              <div id="homeOfficeDetailedBreakdown" style="font-size: 0.875rem; color: var(--muted); margin-top: 0.5rem;"></div>
            </div>
          </div>
          <div class="savings-summary">
            <div class="savings-amount" id="homeOfficeDeduction">$0</div>
            <div class="savings-label" id="homeOfficeRecommendation" data-i18n="homeOffice.totalDeduction">
              D√©duction recommand√©e
            </div>
          </div>
          <div id="homeOfficeWarnings" style="margin-top: 1rem; padding: 1rem; background: rgba(245, 158, 11, 0.05); border: 1px solid var(--warning); border-radius: 6px; display: none;">
            <p style="margin: 0; color: var(--warning);"></p>
          </div>
        </div>

        <!-- Comparison Results -->
        <div id="comparisonResults" class="result-box" style="display:none; margin-top:2rem;">
          <div class="result-title">
            üîÑ <span>Comparaison des m√©thodes</span>
          </div>
          <div class="comparison-grid">
            <div class="result-card simplified-result">
              <h5 data-i18n="homeOffice.comparisonSimplified">M√©thode simplifi√©e</h5>
              <p class="amount" id="simplifiedResult">$0</p>
            </div>
            
            <div class="result-card detailed-result">
              <h5 data-i18n="homeOffice.comparisonDetailed">M√©thode d√©taill√©e</h5>
              <p class="amount" id="detailedResult">$0</p>
            </div>
            
            <div class="recommendation-banner">
              <strong data-i18n="homeOffice.bestOption">üí∞ Meilleure option:</strong> <span id="bestMethod"></span>
              <br>
              <strong data-i18n="homeOffice.savings">√âconomie:</strong> <span id="savingsAmount"></span>
            </div>
          </div>
        </div>
      </section>
      <section id="quarterly" class="tab-content">
        <h2>üìÖ <span data-i18n="quarterly.title">Planificateur d'acomptes trimestriels</span></h2>
        <p data-i18n="quarterly.description">
          Planifiez vos paiements pour √©viter les int√©r√™ts et p√©nalit√©s.
        </p>
        <div class="form-grid">
          <div class="form-group">
            <label for="estimatedIncome" data-i18n="quarterly.estimatedIncome"
              >Revenu net estim√© (apr√®s d√©penses)</label
            ><input type="number" id="estimatedIncome" placeholder="ex: 50000" min="0" />
          </div>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="calculateQuarterly()" data-i18n="quarterly.calculate">
            Calculer mes acomptes
          </button>
        </div>
        <div id="quarterlyResults" class="result-box" style="display: none">
          <div class="result-title">
            üìä <span data-i18n="quarterly.schedule">Calendrier de paiement</span>
          </div>
          <div class="payment-schedule">
            <div class="payment-card">
              <div class="payment-quarter">T1</div>
              <div class="payment-date" data-i18n="quarterly.q1">15 mars</div>
              <div class="payment-amount" id="q1Amount">$0</div>
            </div>
            <div class="payment-card">
              <div class="payment-quarter">T2</div>
              <div class="payment-date" data-i18n="quarterly.q2">15 juin</div>
              <div class="payment-amount" id="q2Amount">$0</div>
            </div>
            <div class="payment-card">
              <div class="payment-quarter">T3</div>
              <div class="payment-date" data-i18n="quarterly.q3">15 septembre</div>
              <div class="payment-amount" id="q3Amount">$0</div>
            </div>
            <div class="payment-card">
              <div class="payment-quarter">T4</div>
              <div class="payment-date" data-i18n="quarterly.q4">15 d√©cembre</div>
              <div class="payment-amount" id="q4Amount">$0</div>
            </div>
          </div>
          <div class="result-grid" style="margin-top: 1.5rem">
            <div class="result-item">
              <div class="result-label" data-i18n="quarterly.weekly">√âpargne hebdomadaire</div>
              <div class="result-value positive" id="weeklyAmount">$0</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="quarterly.annual">Total annuel</div>
              <div class="result-value" id="annualTotal">$0</div>
            </div>
          </div>
        </div>
      </section>
      <section id="selfemploy" class="tab-content">
        <h2>üíº <span data-i18n="selfemploy.title">Calculateur RRQ travailleur autonome</span></h2>
        <p data-i18n="selfemploy.description">
          En tant que travailleur autonome, vous payez les portions employeur ET employ√© du RRQ/RPC.
        </p>
        <div class="form-grid">
          <div class="form-group">
            <label for="selfEmployIncome" data-i18n="selfemploy.netIncome"
              >Revenu net de travail autonome ($)</label
            ><input type="number" id="selfEmployIncome" placeholder="ex: 50000" min="0" /><span
              class="label-hint"
              data-i18n="selfemploy.hint"
              >Apr√®s d√©penses d'entreprise</span
            >
          </div>
        </div>
        <div class="btn-group">
          <button class="btn" onclick="calculateSelfEmploy()" data-i18n="selfemploy.calculate">
            Calculer mes cotisations
          </button>
        </div>
        <div id="selfEmployResults" class="result-box" style="display: none">
          <div class="result-title">
            üìä <span data-i18n="selfemploy.results">Cotisations RRQ/RPC</span>
          </div>
          <div class="result-grid">
            <div class="result-item">
              <div class="result-label" data-i18n="selfemploy.total">Cotisation totale</div>
              <div class="result-value" id="qppTotal">$0</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="selfemploy.deductible">
                Portion d√©ductible (employeur)
              </div>
              <div class="result-value positive" id="qppDeductible">$0</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="selfemploy.netCost">
                Co√ªt net apr√®s d√©duction
              </div>
              <div class="result-value" id="qppNetCost">$0</div>
            </div>
            <div class="result-item">
              <div class="result-label" data-i18n="selfemploy.rate">Taux effectif</div>
              <div class="result-value" id="qppRate">12.8%</div>
            </div>
          </div>
          <div
            style="
              background: #fef3c7;
              border: 1px solid #f59e0b;
              border-radius: 8px;
              padding: 1rem;
              margin-top: 1rem;
            "
          >
            <strong>üí° <span data-i18n="selfemploy.tip">Conseil:</span></strong>
            <span data-i18n="selfemploy.tipText"
              >La portion employeur est d√©ductible de votre revenu imposable!</span
            >
          </div>
        </div>
      </section>
      <section id="businessExpenses" class="tab-content">
        <h2>üìä <span data-i18n="businessExpenses.title">Business Expense Tracker</span></h2>
        <p data-i18n="businessExpenses.subtitle">
          Track your business expenses for T2125 form preparation
        </p>

        <!-- Manual Expense Entry Form -->
        <fieldset>
          <legend data-i18n="businessExpenses.addExpense">Add Expense</legend>
          <div class="form-grid">
            <div class="form-group">
              <label for="expenseDate" data-i18n="businessExpenses.date">Date</label>
              <input type="date" id="expenseDate" />
            </div>
            <div class="form-group">
              <label for="expenseVendor" data-i18n="businessExpenses.vendor">Vendor</label>
              <input type="text" id="expenseVendor" placeholder="e.g., Gas Station" />
            </div>
            <div class="form-group">
              <label for="expenseCategory" data-i18n="businessExpenses.category">Category</label>
              <select id="expenseCategory">
                <option value="ADVERTISING">Advertising</option>
                <option value="MEALS_ENTERTAINMENT">Meals & Entertainment (50% deductible)</option>
                <option value="BAD_DEBTS">Bad Debts</option>
                <option value="INSURANCE">Insurance</option>
                <option value="INTEREST">Interest & Bank Charges</option>
                <option value="FEES">Professional Fees</option>
                <option value="OFFICE">Office Expenses</option>
                <option value="SUPPLIES">Supplies</option>
                <option value="PHONE_UTILITIES">Phone & Utilities</option>
                <option value="RENT">Rent</option>
                <option value="REPAIRS">Repairs & Maintenance</option>
                <option value="TRAVEL">Travel</option>
                <option value="VEHICLE" selected>Vehicle Expenses</option>
                <option value="HOME_OFFICE">Home Office</option>
                <option value="OTHER">Other Expenses</option>
              </select>
            </div>
            <div class="form-group">
              <label for="expenseAmount" data-i18n="businessExpenses.amount">Amount ($)</label>
              <input type="number" id="expenseAmount" placeholder="0.00" min="0" step="0.01" />
            </div>
          </div>
          <div class="form-group">
            <label for="expenseDescription" data-i18n="businessExpenses.description">Description (Optional)</label>
            <input type="text" id="expenseDescription" placeholder="e.g., Gas for business trips" />
          </div>
          <div class="btn-group">
            <button class="btn" onclick="addManualExpense()" data-i18n="businessExpenses.addButton">
              Add Expense
            </button>
          </div>
        </fieldset>

        <!-- Expense Summary -->
        <div id="expenseSummary" class="result-box" style="margin-top: 2rem;">
          <div class="result-title">
            üìà <span data-i18n="businessExpenses.summary">Expense Summary</span>
          </div>
          <div class="method-comparison">
            <div class="method-card">
              <h4 data-i18n="businessExpenses.totalReceipts">Total Receipts</h4>
              <div class="amount" id="totalReceipts">0</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="businessExpenses.totalExpenses">Total Expenses</h4>
              <div class="amount" id="totalExpenses">$0.00</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="businessExpenses.totalDeductible">Total Deductible</h4>
              <div class="amount" id="totalDeductible">$0.00</div>
            </div>
          </div>

          <!-- Category Breakdown Table -->
          <div style="margin-top: 1.5rem;">
            <h4 data-i18n="businessExpenses.categoryBreakdown">Category Breakdown</h4>
            <div style="overflow-x: auto; margin-top: 1rem;">
              <table style="width: 100%; border-collapse: collapse; background: var(--card);">
                <thead>
                  <tr style="background: var(--bg); border-bottom: 2px solid var(--border);">
                    <th style="padding: 0.75rem; text-align: left;">Category</th>
                    <th style="padding: 0.75rem; text-align: center;">T2125 Line</th>
                    <th style="padding: 0.75rem; text-align: center;">Count</th>
                    <th style="padding: 0.75rem; text-align: right;">Total Amount</th>
                    <th style="padding: 0.75rem; text-align: right;">Deductible</th>
                  </tr>
                </thead>
                <tbody id="categoryBreakdownBody">
                  <tr>
                    <td colspan="5" style="padding: 1rem; text-align: center; color: var(--muted);">
                      No expenses added yet
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- Export Buttons -->
          <div class="btn-group" style="margin-top: 1.5rem;">
            <button class="btn btn-primary" onclick="exportForAccountant()">
              üìä Export for Accountant (T2125)
            </button>
            <button class="btn btn-secondary" onclick="exportToT2125JSON()" data-i18n="businessExpenses.exportJSON">
              Export to T2125 JSON
            </button>
            <button class="btn btn-secondary" onclick="exportToCSV()" data-i18n="businessExpenses.exportCSV">
              üìÑ Export to CSV
            </button>
          </div>
        </div>
      </section>

      <!-- Medical Expenses Tab -->
      <section id="medical" class="tab-content">
        <h2>üíä <span data-i18n="medical.title">Medical Expense Tax Credit</span></h2>
        <p data-i18n="medical.description">
          Track medical expenses and calculate your tax credits. Federal: 15% on expenses exceeding 3% of income. Quebec: 20%.
        </p>

        <!-- Income Input -->
        <fieldset>
          <legend data-i18n="medical.netIncome">Net Income</legend>
          <div class="form-group">
            <label for="medicalNetIncome">Annual Net Income ($)</label>
            <input type="number" id="medicalNetIncome" placeholder="50000" min="0" step="1" />
          </div>
        </fieldset>

        <!-- Add Medical Expense Form -->
        <fieldset>
          <legend data-i18n="medical.addExpense">Add Medical Expense</legend>
          <div class="form-grid">
            <div class="form-group">
              <label for="medicalCategory" data-i18n="medical.category">Category</label>
              <select id="medicalCategory">
                <option value="prescriptions">üíä Prescriptions</option>
                <option value="dental">ü¶∑ Dental</option>
                <option value="vision">üëì Vision/Optical</option>
                <option value="practitioners">ü©∫ Medical Practitioners</option>
                <option value="other">üìã Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="medicalAmount" data-i18n="medical.amount">Amount ($)</label>
              <input type="number" id="medicalAmount" placeholder="100.00" min="0" step="0.01" />
            </div>
            <div class="form-group">
              <label for="medicalDate" data-i18n="medical.date">Date</label>
              <input type="date" id="medicalDate" />
            </div>
          </div>
          <div class="form-group">
            <label for="medicalDescription" data-i18n="medical.descriptionLabel">Description</label>
            <input type="text" id="medicalDescription" placeholder="e.g., Dental cleaning, Glasses, Prescription medication" />
          </div>
          <div class="btn-group">
            <button class="btn" onclick="addMedicalExpense()" data-i18n="medical.addButton">Add Medical Expense</button>
          </div>
        </fieldset>

        <!-- Medical Expenses List -->
        <div id="medicalExpensesList" style="margin-top: 1rem;">
          <h3><span data-i18n="medical.recordedExpenses">üìù Recorded Expenses</span></h3>
          <div id="medicalExpensesTable"></div>
        </div>

        <!-- Credit Calculation Results -->
        <div id="medicalResults" class="result-box" style="margin-top: 2rem;">
          <div class="result-title">
            üí∞ <span data-i18n="medical.creditTitle">Medical Expense Tax Credit</span>
          </div>
          <div class="method-comparison">
            <div class="method-card">
              <h4 data-i18n="medical.totalExpenses">Total Expenses</h4>
              <div class="amount" id="medicalTotalExpenses">$0.00</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="medical.threshold">Threshold (3% of income)</h4>
              <div class="amount" id="medicalThreshold">$0.00</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="medical.eligible">Eligible Amount</h4>
              <div class="amount" id="medicalEligible">$0.00</div>
            </div>
          </div>
          <div class="savings-box">
            <div class="savings-label" data-i18n="medical.federalCredit">Federal Credit (15%)</div>
            <div class="savings-amount" id="medicalFederalCredit">$0.00</div>
          </div>
          <div class="savings-box">
            <div class="savings-label" data-i18n="medical.quebecCredit">Quebec Credit (20%)</div>
            <div class="savings-amount" id="medicalQuebecCredit">$0.00</div>
          </div>
          <div class="savings-box highlight">
            <div class="savings-label" data-i18n="medical.totalCredit">Total Tax Credit</div>
            <div class="savings-amount" id="medicalTotalCredit">$0.00</div>
          </div>
          <div class="btn-group">
            <button class="btn" onclick="calculateMedicalCredit()" data-i18n="medical.calculate">Calculate Credit</button>
          </div>
        </div>
      </section>

      <!-- Childcare Expenses Tab -->
      <section id="childcare" class="tab-content">
        <h2>üë∂ <span data-i18n="childcare.title">Childcare Expense Deduction</span></h2>
        <p data-i18n="childcare.description">
          Track childcare expenses and calculate your deduction. 2026 limits: $8,000 (under 7), $5,000 (7-16), $11,000 (disabled).
        </p>

        <!-- Earned Income Input -->
        <fieldset>
          <legend data-i18n="childcare.earnedIncome">Earned Income</legend>
          <div class="form-group">
            <label for="childcareEarnedIncome" data-i18n="childcare.earnedIncomeLabel">Annual Earned Income ($)</label>
            <input type="number" id="childcareEarnedIncome" placeholder="50000" min="0" step="1" />
          </div>
        </fieldset>

        <!-- Add Child Form -->
        <fieldset>
          <legend data-i18n="childcare.addChild">Add Child</legend>
          <div class="form-grid">
            <div class="form-group">
              <label for="childAge" data-i18n="childcare.childAge">Child's Age</label>
              <input type="number" id="childAge" placeholder="5" min="0" max="18" />
            </div>
            <div class="form-group">
              <label for="childDisabled" data-i18n="childcare.hasDisability">Has Disability</label>
              <select id="childDisabled">
                <option value="false">No</option>
                <option value="true">Yes</option>
              </select>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn" onclick="addChild()" data-i18n="childcare.addChildButton">Add Child</button>
          </div>
        </fieldset>

        <!-- Children List -->
        <div id="childrenList" style="margin-top: 1rem;">
          <h3><span data-i18n="childcare.children">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Children</span></h3>
          <div id="childrenTable"></div>
        </div>

        <!-- Add Childcare Expense -->
        <fieldset>
          <legend data-i18n="childcare.expenses">Childcare Expenses</legend>
          <div class="form-grid">
            <div class="form-group">
              <label for="childcareExpenseAmount" data-i18n="childcare.totalAnnualExpenses">Total Annual Expenses ($)</label>
              <input type="number" id="childcareExpenseAmount" placeholder="10000" min="0" step="0.01" />
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="providerName" data-i18n="childcare.providerName">Provider Name</label>
              <input type="text" id="providerName" placeholder="ABC Daycare or Jane Doe" />
            </div>
            <div class="form-group">
              <label for="providerSinBn" data-i18n="childcare.providerSinBn">Provider SIN or Business Number</label>
              <input type="text" id="providerSinBn" placeholder="123456789 or 123456789RC0001" />
            </div>
          </div>
        </fieldset>

        <!-- Deduction Calculation Results -->
        <div id="childcareResults" class="result-box" style="margin-top: 2rem;">
          <div class="result-title">
            üí∞ <span data-i18n="childcare.deductionTitle">Childcare Expense Deduction</span>
          </div>
          <div class="method-comparison">
            <div class="method-card">
              <h4 data-i18n="childcare.totalExpenses">Total Expenses</h4>
              <div class="amount" id="childcareTotalExpenses">$0.00</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="childcare.perChildLimit">Per-Child Limit</h4>
              <div class="amount" id="childcarePerChildLimit">$0.00</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="childcare.incomeLimit">2/3 Earned Income Limit</h4>
              <div class="amount" id="childcareIncomeLimit">$0.00</div>
            </div>
          </div>
          <div class="savings-box highlight">
            <div class="savings-label" data-i18n="childcare.deduction">Eligible Deduction</div>
            <div class="savings-amount" id="childcareDeduction">$0.00</div>
          </div>
          <div style="margin-top: 1rem; padding: 1rem; background: var(--accent-light); border-radius: 8px;">
            <small id="childcareLimitMessage">Enter expenses and earned income to see which limit applies.</small>
          </div>
          <div class="btn-group">
            <button class="btn" onclick="calculateChildcareDeduction()" data-i18n="childcare.calculate">Calculate Deduction</button>
          </div>
        </div>
      </section>

      <!-- Charitable Donations Tab -->
      <section id="donations" class="tab-content">
        <h2>‚ù§Ô∏è <span data-i18n="donations.title">Charitable Donation Tax Credit</span></h2>
        <p data-i18n="donations.description">
          Track charitable donations and calculate your tax credits. Federal: 15% on first $200, 29% on remainder. Quebec: flat 25%.
        </p>

        <!-- Add Donation Form -->
        <fieldset>
          <legend data-i18n="donations.addDonation">Add Donation</legend>
          <div class="form-grid">
            <div class="form-group">
              <label for="charityName" data-i18n="donations.charityName">Charity Name</label>
              <input type="text" id="charityName" placeholder="e.g., Red Cross Canada" />
            </div>
            <div class="form-group">
              <label for="donationAmount" data-i18n="donations.amount">Amount ($)</label>
              <input type="number" id="donationAmount" placeholder="100.00" min="0" step="0.01" />
            </div>
          </div>
          <div class="form-grid">
            <div class="form-group">
              <label for="registrationNumber" data-i18n="donations.registrationNumber">Charity Registration Number (Optional)</label>
              <input type="text" id="registrationNumber" placeholder="123456789RR0001" />
            </div>
            <div class="form-group">
              <label for="donationDate" data-i18n="donations.date">Date</label>
              <input type="date" id="donationDate" />
            </div>
          </div>
          <div class="btn-group">
            <button class="btn" onclick="addDonation()" data-i18n="donations.addButton">Add Donation</button>
          </div>
        </fieldset>

        <!-- Donations List -->
        <div id="donationsList" style="margin-top: 1rem;">
          <h3><span data-i18n="donations.recordedDonations">üìù Recorded Donations</span></h3>
          <div id="donationsTable"></div>
        </div>

        <!-- Credit Calculation Results -->
        <div id="donationResults" class="result-box" style="margin-top: 2rem;">
          <div class="result-title">
            üí∞ <span data-i18n="donations.creditTitle">Charitable Donation Tax Credit</span>
          </div>
          <div class="method-comparison">
            <div class="method-card">
              <h4 data-i18n="donations.totalDonations">Total Donations</h4>
              <div class="amount" id="donationTotal">$0.00</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="donations.firstTier">First $200 (15%)</h4>
              <div class="amount" id="donationFirstTier">$0.00</div>
            </div>
            <div class="method-card">
              <h4 data-i18n="donations.secondTier">Remainder (29%)</h4>
              <div class="amount" id="donationSecondTier">$0.00</div>
            </div>
          </div>
          <div class="savings-box">
            <div class="savings-label" data-i18n="donations.federalCredit">Federal Credit</div>
            <div class="savings-amount" id="donationFederalCredit">$0.00</div>
          </div>
          <div class="savings-box">
            <div class="savings-label" data-i18n="donations.quebecCredit">Quebec Credit (25%)</div>
            <div class="savings-amount" id="donationQuebecCredit">$0.00</div>
          </div>
          <div class="savings-box highlight">
            <div class="savings-label" data-i18n="donations.totalCredit">Total Tax Credit</div>
            <div class="savings-amount" id="donationTotalCredit">$0.00</div>
          </div>
          <div style="margin-top: 1rem; padding: 1rem; background: var(--accent-light); border-radius: 8px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <strong>Effective Rate:</strong> <span id="donationEffectiveRate">0%</span>
              </div>
              <div>
                <strong>Net Cost:</strong> <span id="donationNetCost">$0.00</span>
              </div>
            </div>
          </div>
          <div class="btn-group">
            <button class="btn" onclick="calculateDonationCredit()" data-i18n="donations.calculate">Calculate Credit</button>
          </div>
        </div>
      </section>
      
      <!-- Ontario Trillium Benefit Calculator -->
      <section id="ontarioTrillium" class="tab-content province-specific on-only" style="display:none;">
        <h2>üí∞ <span data-i18n="ontarioTrillium.title">Calculateur du cr√©dit Trillium de l'Ontario</span></h2>
        <p data-i18n="ontarioTrillium.description">Calculez vos cr√©dits combin√©s pour l'√©nergie, l'imp√¥t foncier et la taxe de vente</p>
        
        <div class="info-banner">
          <strong data-i18n="ontarioTrillium.combinedCredits">üí° Le cr√©dit Trillium de l'Ontario combine:</strong>
          <ul>
            <li data-i18n="ontarioTrillium.oeptc">Cr√©dit de l'Ontario pour l'√©nergie et l'imp√¥t foncier (COEIF)</li>
            <li data-i18n="ontarioTrillium.noec">Cr√©dit d'√©nergie du Nord de l'Ontario (CENO) - si dans le Nord de l'Ontario</li>
            <li data-i18n="ontarioTrillium.ostc">Cr√©dit de taxe de vente de l'Ontario (CTVO)</li>
          </ul>
          <p data-i18n="ontarioTrillium.benefitInfo">Pay√© mensuellement, jusqu'√† ~1 400 $/ann√©e pour les familles!</p>
        </div>
        
        <!-- Household Information -->
        <div class="form-section">
          <h4 data-i18n="ontarioTrillium.householdInfo">Information du m√©nage</h4>
          
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="ontarioTrillium.maritalStatus">√âtat matrimonial:</label>
              <select id="ontarioMaritalStatus">
                <option value="single" data-i18n="ontarioTrillium.single">C√©libataire</option>
                <option value="married" data-i18n="ontarioTrillium.married">Mari√©(e)</option>
                <option value="common-law" data-i18n="ontarioTrillium.commonLaw">Conjoint de fait</option>
              </select>
            </div>
            
            <div class="form-group">
              <label data-i18n="ontarioTrillium.netIncome">Votre revenu net:</label>
              <input type="number" id="ontarioNetIncome" step="0.01" placeholder="e.g., 45000">
            </div>
            
            <div class="form-group">
              <label data-i18n="ontarioTrillium.familyIncome">Revenu net familial (si en couple):</label>
              <input type="number" id="ontarioFamilyIncome" step="0.01" placeholder="Revenu combin√©">
            </div>
            
            <div class="form-group">
              <label data-i18n="ontarioTrillium.numberOfChildren">Nombre d'enfants:</label>
              <input type="number" id="ontarioChildren" min="0" value="0">
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="ontarioSenior">
                <span data-i18n="ontarioTrillium.senior">√Çg√© de 64 ans ou plus</span>
              </label>
            </div>
            
            <div class="form-group">
              <label data-i18n="ontarioTrillium.postalCode">Code postal:</label>
              <input type="text" id="ontarioPostalCode" placeholder="e.g., M5H 2N2" maxlength="7">
              <small data-i18n="ontarioTrillium.postalCodeHint">Utilis√© pour d√©tecter le Nord de l'Ontario</small>
            </div>
          </div>
        </div>
        
        <!-- Housing Costs -->
        <div class="form-section">
          <h4 data-i18n="ontarioTrillium.housingCosts">Co√ªts de logement (annuel)</h4>
          
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="ontarioTrillium.propertyTax">Imp√¥t foncier pay√© (si propri√©taire):</label>
              <input type="number" id="ontarioPropertyTax" step="0.01" placeholder="0.00">
            </div>
            
            <div class="form-group">
              <label data-i18n="ontarioTrillium.rent">Loyer pay√© (si locataire):</label>
              <input type="number" id="ontarioRent" step="0.01" placeholder="0.00">
              <small data-i18n="ontarioTrillium.rentHint">Montant de loyer annuel</small>
            </div>
          </div>
        </div>
        
        <button id="calculateOntarioTrilliumBtn" class="btn btn-primary" data-i18n="ontarioTrillium.calculate">Calculer le cr√©dit Trillium</button>
        
        <!-- Results -->
        <div id="ontarioTrilliumResults" style="display:none;" class="results-section">
          <h4 data-i18n="ontarioTrillium.results">üìä Votre cr√©dit Trillium de l'Ontario</h4>
          
          <div class="summary-cards">
            <div class="summary-card">
              <h5 data-i18n="ontarioTrillium.energyPropertyCredit">Cr√©dit pour l'√©nergie et l'imp√¥t foncier</h5>
              <p class="big-number" id="ontarioEPTC">$0.00</p>
            </div>
            
            <div class="summary-card" id="northernCreditCard" style="display:none;">
              <h5 data-i18n="ontarioTrillium.northernCredit">Cr√©dit d'√©nergie du Nord de l'Ontario</h5>
              <p class="big-number" id="ontarioNorthern">$0.00</p>
              <span class="badge" data-i18n="ontarioTrillium.northernBadge">Northern ON</span>
            </div>
            
            <div class="summary-card">
              <h5 data-i18n="ontarioTrillium.salesTaxCredit">Cr√©dit de taxe de vente de l'Ontario</h5>
              <p class="big-number" id="ontarioSTC">$0.00</p>
            </div>
            
            <div class="summary-card highlight">
              <h5 data-i18n="ontarioTrillium.totalBenefit">Prestation annuelle totale</h5>
              <p class="big-number" id="ontarioTrilliumTotal">$0.00</p>
            </div>
            
            <div class="summary-card payment-info">
              <h5 data-i18n="ontarioTrillium.monthlyPayment">Paiement mensuel</h5>
              <p class="big-number" id="ontarioTrilliumMonthly">$0.00</p>
              <small data-i18n="ontarioTrillium.monthlyHint">Pay√© automatiquement chaque mois</small>
            </div>
          </div>
        </div>
      </section>
      
      <!-- BC Climate Action Tax Credit Tab -->
      <section id="bcClimateAction" class="tab-content province-specific bc-only" style="display:none;">
        <h2>üå± <span data-i18n="bcClimateAction.title">BC Climate Action Tax Credit</span></h2>
        <p data-i18n="bcClimateAction.subtitle">Quarterly payment to offset carbon tax costs</p>
        
        <div class="info-banner">
          <strong data-i18n="bcClimateAction.amounts">üí° 2026 Amounts:</strong>
          <span data-i18n="bcClimateAction.amountsDetail">$193.50/adult + $56.50/child per quarter (4 payments/year)</span>
          <br>
          <strong data-i18n="bcClimateAction.paymentMonths">Payment Months:</strong>
          <span data-i18n="bcClimateAction.months">July, October, January, April</span>
        </div>
        
        <div class="form-section">
          <h4 data-i18n="bcClimateAction.householdInfo">Household Information</h4>
          
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="bcClimateAction.maritalStatus">Marital Status:</label>
              <select id="bcMaritalStatus">
                <option value="single" data-i18n="bcClimateAction.single">Single</option>
                <option value="married" data-i18n="bcClimateAction.married">Married</option>
                <option value="common-law" data-i18n="bcClimateAction.commonLaw">Common-law</option>
              </select>
            </div>
            
            <div class="form-group">
              <label data-i18n="bcClimateAction.numberOfAdults">Number of Adults:</label>
              <input type="number" id="bcNumberOfAdults" min="1" max="2" value="1">
            </div>
            
            <div class="form-group">
              <label data-i18n="bcClimateAction.numberOfChildren">Number of Children (under 19):</label>
              <input type="number" id="bcNumberOfChildren" min="0" value="0">
            </div>
            
            <div class="form-group">
              <label data-i18n="bcClimateAction.familyIncome">Net Family Income:</label>
              <input type="number" id="bcFamilyIncome" step="0.01" placeholder="e.g., 45000">
            </div>
          </div>
          
          <button id="calculateBCClimateBtn" class="btn btn-primary" data-i18n="bcClimateAction.calculate">Calculate Climate Action Credit</button>
        </div>
        
        <!-- Results -->
        <div id="bcClimateResults" style="display:none;" class="results-section">
          <h4 data-i18n="bcClimateAction.results">üìä Your BC Climate Action Tax Credit</h4>
          
          <div class="summary-cards">
            <div class="summary-card">
              <h5 data-i18n="bcClimateAction.annualCredit">Annual Credit</h5>
              <p class="big-number" id="bcClimateAnnual">$0.00</p>
            </div>
            
            <div class="summary-card highlight">
              <h5 data-i18n="bcClimateAction.quarterlyPayment">Quarterly Payment</h5>
              <p class="big-number" id="bcClimateQuarterly">$0.00</p>
              <small data-i18n="bcClimateAction.paymentFreq">Paid 4 times/year</small>
            </div>
          </div>
          
          <div class="payment-schedule">
            <h5 data-i18n="bcClimateAction.paymentSchedule">Payment Schedule:</h5>
            <ul>
              <li>üóìÔ∏è <strong data-i18n="bcClimateAction.july">July 5:</strong> <span id="bcPayment1">$0.00</span></li>
              <li>üóìÔ∏è <strong data-i18n="bcClimateAction.october">October 5:</strong> <span id="bcPayment2">$0.00</span></li>
              <li>üóìÔ∏è <strong data-i18n="bcClimateAction.january">January 5:</strong> <span id="bcPayment3">$0.00</span></li>
              <li>üóìÔ∏è <strong data-i18n="bcClimateAction.april">April 5:</strong> <span id="bcPayment4">$0.00</span></li>
            </ul>
          </div>
        </div>
      </section>

      <!-- BC Affordability Credit Tab -->
      <section id="bcAffordability" class="tab-content province-specific bc-only" style="display:none;">
        <h2>üí∞ <span data-i18n="bcAffordability.title">BC Affordability Credit</span></h2>
        <p data-i18n="bcAffordability.subtitle">Annual payment to help with cost of living</p>
        
        <div class="info-banner">
          <strong data-i18n="bcAffordability.amounts">üí° 2026 Amounts:</strong>
          <span data-i18n="bcAffordability.amountsDetail">$164 individual, $246 couple, +$41 per child</span>
        </div>
        
        <div class="form-section">
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="bcAffordability.maritalStatus">Marital Status:</label>
              <select id="bcAffordMaritalStatus">
                <option value="single" data-i18n="bcAffordability.single">Single</option>
                <option value="married" data-i18n="bcAffordability.married">Married</option>
                <option value="common-law" data-i18n="bcAffordability.commonLaw">Common-law</option>
              </select>
            </div>
            
            <div class="form-group">
              <label data-i18n="bcAffordability.numberOfChildren">Number of Children:</label>
              <input type="number" id="bcAffordChildren" min="0" value="0">
            </div>
            
            <div class="form-group">
              <label data-i18n="bcAffordability.familyIncome">Net Family Income:</label>
              <input type="number" id="bcAffordIncome" step="0.01">
            </div>
          </div>
          
          <button id="calculateBCAffordBtn" class="btn btn-primary" data-i18n="bcAffordability.calculate">Calculate Affordability Credit</button>
        </div>
        
        <div id="bcAffordResults" style="display:none;" class="results-section">
          <div class="summary-card highlight">
            <h5 data-i18n="bcAffordability.credit">BC Affordability Credit</h5>
            <p class="big-number" id="bcAffordCredit">$0.00</p>
          </div>
        </div>
      </section>

      <!-- BC Home Owner Grant Tab -->
      <section id="bcHomeOwner" class="tab-content province-specific bc-only" style="display:none;">
        <h2>üè† <span data-i18n="bcHomeOwner.title">BC Home Owner Grant</span></h2>
        <p data-i18n="bcHomeOwner.subtitle">Property tax reduction for homeowners</p>
        
        <div class="info-banner">
          <strong data-i18n="bcHomeOwner.grants">üí° Grant Amounts (2026):</strong>
          <br>
          <span data-i18n="bcHomeOwner.regular">Regular: $570 basic, $845 senior (65+)</span>
          <br>
          <span data-i18n="bcHomeOwner.northern">Northern/Rural: $770 basic, $1,045 senior</span>
        </div>
        
        <div class="form-section">
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="bcHomeOwner.propertyValue">Property Assessed Value:</label>
              <input type="number" id="bcPropertyValue" step="1000" placeholder="e.g., 850000">
            </div>
            
            <div class="form-group">
              <label data-i18n="bcHomeOwner.ownerAge">Owner Age:</label>
              <input type="number" id="bcOwnerAge" min="0" placeholder="e.g., 45">
            </div>
            
            <div class="form-group">
              <label data-i18n="bcHomeOwner.municipality">Municipality:</label>
              <input type="text" id="bcMunicipality" placeholder="e.g., Vancouver">
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="bcIsDisabled">
                <span data-i18n="bcHomeOwner.disabled">Person with disability</span>
              </label>
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="bcIsVeteran">
                <span data-i18n="bcHomeOwner.veteran">Veteran</span>
              </label>
            </div>
            
            <div class="form-group">
              <label>
                <input type="checkbox" id="bcIsNorthern">
                <span data-i18n="bcHomeOwner.northern">Northern/Rural area</span>
              </label>
            </div>
          </div>
          
          <button id="calculateBCHomeGrantBtn" class="btn btn-primary" data-i18n="bcHomeOwner.calculate">Calculate Home Owner Grant</button>
        </div>
        
        <div id="bcHomeGrantResults" style="display:none;" class="results-section">
          <div class="summary-card highlight">
            <h5 data-i18n="bcHomeOwner.grant">BC Home Owner Grant</h5>
            <p class="big-number" id="bcHomeGrant">$0.00</p>
            <p class="note" id="bcHomeGrantNote"></p>
          </div>
        </div>
      </section>
      
      <!-- Universal Provincial Tax Calculator (for all remaining provinces) -->
      <section id="universalProvincial" class="tab-content province-specific mb-only sk-only ns-only nb-only pe-only nl-only yt-only nt-only nu-only" style="display:none;">
        <h2>üìä <span id="provinceName">Provincial</span> <span data-i18n="universalProvincial.title">Tax Calculator</span></h2>
        
        <div class="form-section">
          <div class="form-group">
            <label data-i18n="universalProvincial.taxableIncome">Taxable Income:</label>
            <input type="number" id="universalTaxableIncome" step="0.01" placeholder="e.g., 50000">
          </div>
          
          <div class="form-group">
            <label data-i18n="universalProvincial.basicAmount">Basic Personal Amount:</label>
            <input type="number" id="universalBasicAmount" readonly>
            <small data-i18n="universalProvincial.basicAmountHint">Automatically set for your province</small>
          </div>
          
          <button id="calculateUniversalBtn" class="btn btn-primary" data-i18n="universalProvincial.calculate">Calculate Provincial Tax</button>
        </div>
        
        <div id="universalResults" style="display:none;" class="results-section">
          <div class="summary-cards">
            <div class="summary-card">
              <h5 data-i18n="universalProvincial.provincialTax">Provincial Tax</h5>
              <p class="big-number" id="universalProvincialTax">$0.00</p>
            </div>
            
            <div class="summary-card">
              <h5 data-i18n="universalProvincial.effectiveRate">Effective Rate</h5>
              <p class="big-number" id="universalEffectiveRate">0%</p>
            </div>
          </div>
          
          <div class="tax-breakdown">
            <h5 data-i18n="universalProvincial.bracketBreakdown">Tax Bracket Breakdown:</h5>
            <table id="universalBracketTable">
              <thead>
                <tr>
                  <th data-i18n="universalProvincial.incomeRange">Income Range</th>
                  <th data-i18n="universalProvincial.rate">Rate</th>
                  <th data-i18n="universalProvincial.taxAmount">Tax Amount</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>

      <!-- Alberta Child & Family Benefit Tab -->
      <section id="albertaChildBenefit" class="tab-content province-specific ab-only" style="display:none;">
        <h2>üë∂ <span data-i18n="albertaChildBenefit.title">Alberta Child & Family Benefit</span></h2>
        <p data-i18n="albertaChildBenefit.subtitle">Monthly benefit for families with children under 18</p>
        
        <div class="info-banner">
          <strong data-i18n="albertaChildBenefit.amounts">üí° 2026 Amounts:</strong>
          <br>1st child: $1,330/year | 2nd child: $665/year | 3rd+ child: $665/year each
          <br>Maximum: $2,660 for family with 3+ children
        </div>
        
        <div class="form-section">
          <h4 data-i18n="albertaChildBenefit.familyInfo">Family Information</h4>
          
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="albertaChildBenefit.familyIncome">Family Net Income:</label>
              <input type="number" id="albertaFamilyIncome" step="0.01" placeholder="e.g., 45000">
            </div>
            
            <div class="form-group">
              <label data-i18n="albertaChildBenefit.numberOfChildren">Number of Children (under 18):</label>
              <input type="number" id="albertaNumberOfChildren" min="0" max="6" value="0">
            </div>
          </div>
          
          <button id="calculateAlbertaChildBtn" class="btn btn-primary" data-i18n="albertaChildBenefit.calculate">Calculate Child Benefit</button>
        </div>
        
        <!-- Results -->
        <div id="albertaChildResults" style="display:none;" class="results-section">
          <h4 data-i18n="albertaChildBenefit.yourBenefit">üìä Your Alberta Child & Family Benefit</h4>
          
          <div class="summary-cards">
            <div class="summary-card">
              <h5 data-i18n="albertaChildBenefit.annualBenefit">Annual Benefit</h5>
              <p class="big-number" id="albertaChildAnnual">$0.00</p>
            </div>
            
            <div class="summary-card highlight">
              <h5 data-i18n="albertaChildBenefit.monthlyPayment">Monthly Payment</h5>
              <p class="big-number" id="albertaChildMonthly">$0.00</p>
              <small data-i18n="albertaChildBenefit.paidMonthly">Paid automatically each month</small>
            </div>
          </div>
          
          <div class="breakdown">
            <h5 data-i18n="albertaChildBenefit.breakdown">Breakdown by Child:</h5>
            <ul id="albertaChildBreakdown"></ul>
          </div>
        </div>
      </section>

      <!-- Northern Residents Deduction (Territories only) -->
      <section id="northernResidents" class="tab-content province-specific yt-only nt-only nu-only" style="display:none;">
        <h2>üèîÔ∏è <span data-i18n="northernResidents.title">Northern Residents Deduction</span></h2>
        <p data-i18n="northernResidents.subtitle">Federal deduction for living in prescribed northern zones</p>
        
        <div class="info-banner">
          <strong data-i18n="northernResidents.amounts">üí° 2026 Amounts:</strong>
          <br>
          <span data-i18n="northernResidents.zoneA">Zone A: $22/day (Yukon, NWT, Nunavut) = $8,030/year</span>
          <br>
          <span data-i18n="northernResidents.zoneB">Zone B: $11/day (Northern parts of provinces) = $4,015/year</span>
          <br>
          <span data-i18n="northernResidents.travel">Travel: Up to $2,400 for 2 trips south</span>

      <!-- Alberta Seniors Benefit Tab -->
      <section id="albertaSeniors" class="tab-content province-specific ab-only" style="display:none;">
        <h2>üë¥ <span data-i18n="albertaSeniors.title">Alberta Seniors Benefit</span></h2>
        <p data-i18n="albertaSeniors.subtitle">Monthly benefit for low-income seniors 65+</p>
        
        <div class="info-banner">
          <strong data-i18n="albertaSeniors.maxAmounts">üí° 2026 Maximum Amounts:</strong>
          <br>Single: $3,522/year | Couple: $5,283/year (combined)
        </div>
        
        <div class="form-section">
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="northernResidents.daysInZone">Days lived in northern zone:</label>
              <input type="number" id="northernDays" min="0" max="365" value="365">
            </div>
            
            <div class="form-group">
              <label data-i18n="northernResidents.numberOfTrips">Number of trips outside zone:</label>
              <input type="number" id="northernTrips" min="0" max="2" value="0">
            </div>
            
            <div class="form-group">
              <label data-i18n="northernResidents.travelCosts">Total travel costs:</label>
              <input type="number" id="northernTravelCosts" step="0.01" value="0">
              <small data-i18n="northernResidents.maxPerTrip">Max $1,200 per trip</small>
            </div>
          </div>
          
          <button id="calculateNorthernBtn" class="btn btn-primary" data-i18n="northernResidents.calculate">Calculate Deduction</button>
        </div>
        
        <div id="northernResults" style="display:none;" class="results-section">
          <div class="summary-cards">
            <div class="summary-card">
              <h5 data-i18n="northernResidents.residencyDeduction">Residency Deduction</h5>
              <p class="big-number" id="northernResidency">$0.00</p>
            </div>
            
            <div class="summary-card">
              <h5 data-i18n="northernResidents.travelDeduction">Travel Deduction</h5>
              <p class="big-number" id="northernTravel">$0.00</p>
            </div>
            
            <div class="summary-card highlight">
              <h5 data-i18n="northernResidents.totalDeduction">Total Deduction</h5>
              <p class="big-number" id="northernTotal">$0.00</p>
            </div>
          </div>

              <label data-i18n="albertaSeniors.yourAge">Your Age:</label>
              <input type="number" id="albertaSeniorAge" min="0" placeholder="e.g., 67">
            </div>
            
            <div class="form-group">
              <label data-i18n="albertaSeniors.yourIncome">Your Net Income:</label>
              <input type="number" id="albertaSeniorIncome" step="0.01">
            </div>
            
            <div class="form-group">
              <label data-i18n="albertaSeniors.maritalStatus">Marital Status:</label>
              <select id="albertaSeniorMarital">
                <option value="single" data-i18n="albertaSeniors.single">Single</option>
                <option value="married" data-i18n="albertaSeniors.married">Married</option>
                <option value="common-law" data-i18n="albertaSeniors.commonLaw">Common-law</option>
              </select>
            </div>
            
            <div class="form-group" id="albertaSpouseFields" style="display:none;">
              <label data-i18n="albertaSeniors.spouseAge">Spouse Age:</label>
              <input type="number" id="albertaSpouseAge" min="0">
            </div>
            
            <div class="form-group" id="albertaSpouseIncome" style="display:none;">
              <label data-i18n="albertaSeniors.spouseIncome">Spouse Net Income:</label>
              <input type="number" id="albertaSpouseIncomeField" step="0.01">
            </div>
          </div>
          
          <button id="calculateAlbertaSeniorsBtn" class="btn btn-primary" data-i18n="albertaSeniors.calculate">Calculate Seniors Benefit</button>
        </div>
        
        <div id="albertaSeniorsResults" style="display:none;" class="results-section">
          <div class="summary-card highlight">
            <h5 data-i18n="albertaSeniors.benefit">Alberta Seniors Benefit</h5>
            <p class="big-number" id="albertaSeniorsAnnual">$0.00</p>
            <p class="note">Monthly: <span id="albertaSeniorsMonthly">$0.00</span></p>
          </div>
        </div>
      </section>

      <!-- Alberta Family Employment Credit Tab -->
      <section id="albertaEmploymentCredit" class="tab-content province-specific ab-only" style="display:none;">
        <h2>üíº <span data-i18n="albertaEmploymentCredit.title">Alberta Family Employment Tax Credit</span></h2>
        <p data-i18n="albertaEmploymentCredit.subtitle">Refundable credit for working families with children</p>
        
        <div class="info-banner">
          <strong data-i18n="albertaEmploymentCredit.maxCredit">üí° Maximum Credit:</strong> $2,336 per family
          <br><strong data-i18n="albertaEmploymentCredit.requirement">Requirement:</strong> Working income over $2,760
        </div>
        
        <div class="form-section">
          <div class="form-grid">
            <div class="form-group">
              <label data-i18n="albertaEmploymentCredit.workingIncome">Working Income (employment/self-employment):</label>
              <input type="number" id="albertaWorkingIncome" step="0.01" placeholder="e.g., 35000">
            </div>
            
            <div class="form-group">
              <label data-i18n="albertaEmploymentCredit.familyIncome">Family Net Income:</label>
              <input type="number" id="albertaEmploymentFamilyIncome" step="0.01">
            </div>
            
            <div class="form-group">
              <label data-i18n="albertaEmploymentCredit.numberOfChildren">Number of Children:</label>
              <input type="number" id="albertaEmploymentChildren" min="0" value="0">
            </div>
          </div>
          
          <button id="calculateAlbertaEmploymentBtn" class="btn btn-primary" data-i18n="albertaEmploymentCredit.calculate">Calculate Employment Credit</button>
        </div>
        
        <div id="albertaEmploymentResults" style="display:none;" class="results-section">
          <div class="summary-card highlight">
            <h5 data-i18n="albertaEmploymentCredit.credit">Family Employment Tax Credit</h5>
            <p class="big-number" id="albertaEmploymentCredit">$0.00</p>
            <p class="note" id="albertaEmploymentNote"></p>
          </div>
        </div>
      </section>

      <!-- Alberta Tax Summary Tab -->
      <section id="albertaTaxSummary" class="tab-content province-specific ab-only" style="display:none;">
        <h2>üìä <span data-i18n="albertaTaxSummary.title">Alberta Tax Advantage Calculator</span></h2>
        <p data-i18n="albertaTaxSummary.subtitle">Compare Alberta's low taxes to other provinces</p>
        
        <div class="info-banner">
          <strong data-i18n="albertaTaxSummary.advantages">üéâ Alberta Advantages:</strong>
          <ul>
            <li data-i18n="albertaTaxSummary.lowestRates">‚úÖ Lowest provincial tax rates in Canada (10-15%)</li>
            <li data-i18n="albertaTaxSummary.highestBasic">‚úÖ Highest basic personal amount ($21,885)</li>
            <li data-i18n="albertaTaxSummary.noPST">‚úÖ No provincial sales tax (5% GST only)</li>
            <li data-i18n="albertaTaxSummary.noHealthPremium">‚úÖ No health premium</li>
            <li data-i18n="albertaTaxSummary.noPayroll">‚úÖ No payroll tax</li>
          </ul>
        </div>
        
        <div class="form-section">
          <div class="form-group">
            <label data-i18n="albertaTaxSummary.taxableIncome">Your Taxable Income:</label>
            <input type="number" id="albertaCompareIncome" step="0.01" placeholder="e.g., 75000">
          </div>
          
          <button id="calculateAlbertaCompareBtn" class="btn btn-primary" data-i18n="albertaTaxSummary.compare">Compare to Other Provinces</button>
        </div>
        
        <div id="albertaCompareResults" style="display:none;" class="results-section">
          <h4 data-i18n="albertaTaxSummary.comparisonTitle">Provincial Tax Comparison (Same Income)</h4>
          
          <table class="comparison-table">
            <thead>
              <tr>
                <th data-i18n="albertaTaxSummary.province">Province</th>
                <th data-i18n="albertaTaxSummary.provincialTax">Provincial Tax</th>
                <th data-i18n="albertaTaxSummary.vsAlberta">vs Alberta</th>
              </tr>
            </thead>
            <tbody id="albertaCompareTableBody">
              <!-- Populated dynamically -->
            </tbody>
          </table>
          
          <div class="savings-banner">
            <h5 data-i18n="albertaTaxSummary.savings">üí∞ Your Alberta Tax Savings:</h5>
            <p id="albertaSavingsAmount"></p>
          </div>
        </div>
      </section>
      
    </main>
    <footer>
      <div class="footer-content">
        <div class="footer-row">
          <div class="footer-left">
            <div class="footer-title">üöó TaxSyncForDrivers</div>
            <div class="footer-subtitle" data-i18n="footer.builtBy">
              Construit par Ihab Saloum ‚Ä¢ Projet Open Source
            </div>
          </div>
          <div class="footer-subtitle" data-i18n="footer.calc">
            Calculs c√¥t√© client ‚Ä¢ 100% priv√©
          </div>
        </div>
        <div class="footer-badges">
          <span class="tech-badge">JavaScript</span>
          <span class="tech-badge">HTML5</span>
          <span class="tech-badge">Uber/Lyft/Taxi</span>
          <span class="tech-badge">Bilingue</span>
          <span class="tech-badge">100% Client-Side</span>
        </div>
        <div class="footer-right">
          <a
            href="https://github.com/Isaloum/TaxSyncForDrivers"
            target="_blank"
            class="footer-link"
            aria-label="View source code on GitHub"
          >
            <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <title>GitHub</title>
              <path
                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
              />
            </svg>
            <span data-i18n="footer.viewSource">Voir le code source</span>
          </a>
          <a href="https://github.com/Isaloum" target="_blank" class="footer-link">
            <span data-i18n="footer.moreProjects">Plus de projets ‚Üí</span>
          </a>
        </div>
      </div>
    </footer>
    <script src="translations.js"></script>
    <script src="driver-calculator.js"></script>
    <script type="module">
      import DocumentAutomation from './document-automation.js';
      window.DocumentAutomation = DocumentAutomation;
    </script>
    <script type="module">
      import { BusinessExpenseTracker, EXPENSE_CATEGORIES } from './business-expense-tracker.js';
      window.expenseTracker = new BusinessExpenseTracker();
      window.EXPENSE_CATEGORIES = EXPENSE_CATEGORIES;
    </script>
    <script type="module">
      import { calculateOntarioTax } from './ontario-tax-calculator.js';
      import { calculateOntarioTrilliumBenefit, isNorthernOntario } from './ontario-trillium-calculator.js';
      
      // Make functions available globally
      window.calculateOntarioTax = calculateOntarioTax;
      window.calculateOntarioTrilliumBenefit = calculateOntarioTrilliumBenefit;
      window.isNorthernOntario = isNorthernOntario;
    </script>
    <script type="module">
      import { calculateBCTax, getBCMarginalRate } from './bc-tax-calculator.js';
      import { calculateBCClimateAction, calculateBCAffordability } from './bc-climate-action-calculator.js';
      import { calculateBCHomeOwnerGrant } from './bc-home-owner-grant.js';
      
      // Make BC functions available globally
      window.calculateBCTax = calculateBCTax;
      window.getBCMarginalRate = getBCMarginalRate;
      window.calculateBCClimateAction = calculateBCClimateAction;
      window.calculateBCAffordability = calculateBCAffordability;
      window.calculateBCHomeOwnerGrant = calculateBCHomeOwnerGrant;
    </script>
    <script type="module">
      import { calculateManitobaTax } from './manitoba-tax-calculator.js';
      import { calculateSaskatchewanTax } from './saskatchewan-tax-calculator.js';
      import { 
        calculateNovaScotiaTax, 
        calculateNewBrunswickTax, 
        calculatePEITax, 
        calculateNewfoundlandTax 
      } from './atlantic-provinces-tax-calculator.js';
      import { 
        calculateYukonTax, 
        calculateNWTTax, 
        calculateNunavutTax,
        calculateNorthernResidentsDeduction,
        getNorthernZone
      } from './territories-tax-calculator.js';
      
      // Make provincial tax functions available globally
      window.calculateManitobaTax = calculateManitobaTax;
      window.calculateSaskatchewanTax = calculateSaskatchewanTax;
      window.calculateNovaScotiaTax = calculateNovaScotiaTax;
      window.calculateNewBrunswickTax = calculateNewBrunswickTax;
      window.calculatePEITax = calculatePEITax;
      window.calculateNewfoundlandTax = calculateNewfoundlandTax;
      window.calculateYukonTax = calculateYukonTax;
      window.calculateNWTTax = calculateNWTTax;
      window.calculateNunavutTax = calculateNunavutTax;
      window.calculateNorthernResidentsDeduction = calculateNorthernResidentsDeduction;
      window.getNorthernZone = getNorthernZone;

      import { calculateAlbertaTax, getAlbertaMarginalRate, getCombinedMarginalRate } from './alberta-tax-calculator.js';
      import { 
        calculateAlbertaChildBenefit, 
        calculateAlbertaSeniorsBenefit,
        calculateAlbertaFamilyEmploymentCredit 
      } from './alberta-child-benefit-calculator.js';
      
      // Make Alberta functions available globally
      window.calculateAlbertaTax = calculateAlbertaTax;
      window.getAlbertaMarginalRate = getAlbertaMarginalRate;
      window.getCombinedMarginalRate = getCombinedMarginalRate;
      window.calculateAlbertaChildBenefit = calculateAlbertaChildBenefit;
      window.calculateAlbertaSeniorsBenefit = calculateAlbertaSeniorsBenefit;
      window.calculateAlbertaFamilyEmploymentCredit = calculateAlbertaFamilyEmploymentCredit;
    </script>
    <script>
      // Auto-update year in header
      document.addEventListener('DOMContentLoaded', function () {
        const currentYear = new Date().getFullYear();
        const yearElement = document.getElementById('current-year');
        if (yearElement) {
          yearElement.textContent = currentYear;
        }
      });

      let currentLang = 'fr';
      function setLang(l) {
        currentLang = l;
        
        // Update language toggle buttons
        document
          .querySelectorAll('.lang-btn')
          .forEach((b) => b.classList.toggle('active', b.textContent.trim().toLowerCase() === l));
        
        // Update all data-i18n elements
        document.querySelectorAll('[data-i18n]').forEach((el) => {
          const k = el.getAttribute('data-i18n');
          if (translations[l] && translations[l][k]) el.textContent = translations[l][k];
        });
        
        // Update province dropdown with translated names
        if (typeof window.updateProvinceDropdown === 'function') {
          window.updateProvinceDropdown(l);
        }
        
        // Update HTML lang attribute for accessibility
        document.documentElement.lang = l;
      }
      document.querySelectorAll('.tab-btn').forEach((btn) => {
        btn.addEventListener('click', () => {
          const t = btn.getAttribute('data-tab');
          document.querySelectorAll('.tab-btn').forEach((b) => b.classList.remove('active'));
          document.querySelectorAll('.tab-content').forEach((c) => c.classList.remove('active'));
          btn.classList.add('active');
          document.getElementById(t).classList.add('active');
        });
      });
      document.getElementById('showDetailed').addEventListener('change', function () {
        document.getElementById('detailedSection').style.display = this.checked ? 'block' : 'none';
      });
      
      // Initialize home office method selector cards on page load
      document.addEventListener('DOMContentLoaded', function() {
        // Set initial card styling for selected method
        toggleHomeOfficeMethod();
        
        // Add event listeners to all radio buttons for visual feedback
        document.querySelectorAll('input[name="homeOfficeMethod"]').forEach(radio => {
          radio.addEventListener('change', function() {
            toggleHomeOfficeMethod();
          });
        });
      });
      
      function calculateVehicle() {
        const km = parseFloat(document.getElementById('totalKm').value) || 0;
        const s = DriverCalculator.calculateSimplifiedVehicle(km);
        let d = { deduction: 0 };
        if (document.getElementById('showDetailed').checked) {
          d = DriverCalculator.calculateDetailedVehicle({
            fuel: parseFloat(document.getElementById('fuel').value) || 0,
            insurance: parseFloat(document.getElementById('insurance').value) || 0,
            maintenance: parseFloat(document.getElementById('maintenance').value) || 0,
            businessUsePercent: parseFloat(document.getElementById('businessPercent').value) || 80,
          });
        }
        document.getElementById('vehicleResults').style.display = 'block';
        document.getElementById('simplifiedAmount').textContent =
          '$' + s.deduction.toLocaleString();
        document.getElementById('detailedAmount').textContent = '$' + d.deduction.toLocaleString();
        const sc = document.getElementById('simplifiedCard'),
          dc = document.getElementById('detailedCard');
        sc.classList.remove('recommended');
        dc.classList.remove('recommended');
        document.getElementById('simplifiedBadge').innerHTML = '';
        document.getElementById('detailedBadge').innerHTML = '';
        if (s.deduction >= d.deduction) {
          sc.classList.add('recommended');
          document.getElementById('simplifiedBadge').innerHTML =
            '<span class="recommended-badge">' +
            translations[currentLang]['recommended'] +
            '</span>';
          document.getElementById('vehicleSavings').textContent =
            '$' + s.deduction.toLocaleString();
        } else {
          dc.classList.add('recommended');
          document.getElementById('detailedBadge').innerHTML =
            '<span class="recommended-badge">' +
            translations[currentLang]['recommended'] +
            '</span>';
          document.getElementById('vehicleSavings').textContent =
            '$' + d.deduction.toLocaleString();
        }
      }
      function resetVehicle() {
        document.getElementById('totalKm').value = '';
        ['fuel', 'insurance', 'maintenance'].forEach(
          (i) => (document.getElementById(i).value = '')
        );
        document.getElementById('businessPercent').value = '80';
        document.getElementById('vehicleResults').style.display = 'none';
      }

      // Home Office Calculator Functions
      function toggleHomeOfficeMethod() {
        const method = document.querySelector('input[name="homeOfficeMethod"]:checked').value;
        const simplifiedFields = document.getElementById('homeOfficeSimplifiedFields');
        const detailedFields = document.getElementById('homeOfficeDetailedFields');
        
        // Update card styling
        document.querySelectorAll('.method-selector-cards .method-card').forEach(card => {
          card.style.borderColor = '#e2e8f0';
          card.style.background = 'white';
        });
        
        const selectedRadio = document.querySelector('input[name="homeOfficeMethod"]:checked');
        if (selectedRadio) {
          const parentCard = selectedRadio.closest('.method-card');
          if (parentCard) {
            parentCard.style.borderColor = '#0d9488';
            parentCard.style.background = '#f0fdfa';
          }
        }
        
        // Toggle form fields
        if (method === 'simplified') {
          simplifiedFields.style.display = 'block';
          detailedFields.style.display = 'none';
        } else {
          simplifiedFields.style.display = 'none';
          detailedFields.style.display = 'block';
        }
      }

      function calculateHomeOffice() {
        const method = document.querySelector('input[name="homeOfficeMethod"]:checked').value;
        
        if (method === 'simplified') {
          const workDays = parseFloat(document.getElementById('workDaysHome').value) || 0;
          const result = calculateSimplifiedHomeOffice(workDays);
          
          document.getElementById('homeOfficeResults').style.display = 'block';
          document.getElementById('homeOfficeComparison').style.display = 'none';
          document.getElementById('homeOfficeDeduction').textContent = '$' + result.deduction.toLocaleString();
          document.getElementById('homeOfficeRecommendation').textContent = 
            `${result.workDays} √ó $${result.ratePerDay}`;
          document.getElementById('homeOfficeWarnings').style.display = 'none';
        } else {
          const workspace = {
            workspaceArea: parseFloat(document.getElementById('workspaceArea').value) || 0,
            totalHomeArea: parseFloat(document.getElementById('totalHomeArea').value) || 0
          };
          
          const expenses = {
            rent: parseFloat(document.getElementById('expenseRent').value) || 0,
            mortgageInterest: parseFloat(document.getElementById('expenseMortgage').value) || 0,
            propertyTax: parseFloat(document.getElementById('expensePropertyTax').value) || 0,
            homeInsurance: parseFloat(document.getElementById('expenseHomeInsurance').value) || 0,
            utilities: parseFloat(document.getElementById('expenseUtilities').value) || 0,
            maintenanceRepairs: parseFloat(document.getElementById('expenseMaintenance').value) || 0,
            condoFees: parseFloat(document.getElementById('expenseCondoFees').value) || 0,
            internet: parseFloat(document.getElementById('expenseInternet').value) || 0,
            phone: parseFloat(document.getElementById('expensePhone').value) || 0
          };
          
          const netIncome = parseFloat(document.getElementById('netBusinessIncome').value) || 50000;
          
          const result = calculateDetailedHomeOffice(workspace, expenses, netIncome);
          
          if (result.error) {
            document.getElementById('homeOfficeResults').style.display = 'block';
            document.getElementById('homeOfficeComparison').style.display = 'none';
            document.getElementById('homeOfficeDeduction').textContent = '$0';
            document.getElementById('homeOfficeWarnings').style.display = 'block';
            document.getElementById('homeOfficeWarnings').querySelector('p').textContent = '‚ö†Ô∏è ' + result.error;
            return;
          }
          
          document.getElementById('homeOfficeResults').style.display = 'block';
          document.getElementById('homeOfficeComparison').style.display = 'none';
          document.getElementById('homeOfficeDeduction').textContent = '$' + result.deduction.toLocaleString();
          document.getElementById('homeOfficeRecommendation').textContent = 
            `${result.breakdown.workspacePercent}%`;
          
          if (result.breakdown.limitedByIncome) {
            document.getElementById('homeOfficeWarnings').style.display = 'block';
            document.getElementById('homeOfficeWarnings').querySelector('p').textContent = 
              `‚ö†Ô∏è $${result.breakdown.unusedAmount.toLocaleString()}`;
          } else {
            document.getElementById('homeOfficeWarnings').style.display = 'none';
          }
        }
      }

      function resetHomeOffice() {
        document.getElementById('workDaysHome').value = '200';
        document.getElementById('workspaceArea').value = '150';
        document.getElementById('totalHomeArea').value = '1200';
        ['expenseRent', 'expenseMortgage', 'expensePropertyTax', 'expenseHomeInsurance', 
         'expenseUtilities', 'expenseMaintenance', 'expenseCondoFees', 'expenseInternet', 
         'expensePhone'].forEach(id => document.getElementById(id).value = '0');
        document.getElementById('netBusinessIncome').value = '50000';
        document.getElementById('homeOfficeResults').style.display = 'none';
        document.getElementById('comparisonResults').style.display = 'none';
        document.querySelector('input[name="homeOfficeMethod"][value="simplified"]').checked = true;
        toggleHomeOfficeMethod();
      }

      function compareBothHomeOfficeMethods() {
        // Get simplified method result
        const workDays = parseFloat(document.getElementById('workDaysHome').value) || 0;
        const simplifiedResult = calculateSimplifiedHomeOffice(workDays);
        
        // Get detailed method result
        const workspace = {
          workspaceArea: parseFloat(document.getElementById('workspaceArea').value) || 0,
          totalHomeArea: parseFloat(document.getElementById('totalHomeArea').value) || 0
        };
        
        const expenses = {
          rent: parseFloat(document.getElementById('expenseRent').value) || 0,
          mortgageInterest: parseFloat(document.getElementById('expenseMortgage').value) || 0,
          propertyTax: parseFloat(document.getElementById('expensePropertyTax').value) || 0,
          homeInsurance: parseFloat(document.getElementById('expenseHomeInsurance').value) || 0,
          utilities: parseFloat(document.getElementById('expenseUtilities').value) || 0,
          maintenanceRepairs: parseFloat(document.getElementById('expenseMaintenance').value) || 0,
          condoFees: parseFloat(document.getElementById('expenseCondoFees').value) || 0,
          internet: parseFloat(document.getElementById('expenseInternet').value) || 0,
          phone: parseFloat(document.getElementById('expensePhone').value) || 0
        };
        
        const netIncome = parseFloat(document.getElementById('netBusinessIncome').value) || 50000;
        const detailedResult = calculateDetailedHomeOffice(workspace, expenses, netIncome);
        
        // Show comparison results
        document.getElementById('comparisonResults').style.display = 'block';
        document.getElementById('homeOfficeResults').style.display = 'none';
        
        document.getElementById('simplifiedResult').textContent = '$' + simplifiedResult.deduction.toLocaleString();
        
        if (detailedResult.error) {
          document.getElementById('detailedResult').textContent = '$0';
          document.getElementById('bestMethod').textContent = translations[currentLang]['homeOffice.comparisonSimplified'];
          document.getElementById('savingsAmount').textContent = '$' + simplifiedResult.deduction.toLocaleString();
        } else {
          document.getElementById('detailedResult').textContent = '$' + detailedResult.deduction.toLocaleString();
          
          // Determine best method
          if (simplifiedResult.deduction >= detailedResult.deduction) {
            document.getElementById('bestMethod').textContent = translations[currentLang]['homeOffice.comparisonSimplified'];
            document.getElementById('savingsAmount').textContent = '$' + (simplifiedResult.deduction - detailedResult.deduction).toLocaleString();
          } else {
            document.getElementById('bestMethod').textContent = translations[currentLang]['homeOffice.comparisonDetailed'];
            document.getElementById('savingsAmount').textContent = '$' + (detailedResult.deduction - simplifiedResult.deduction).toLocaleString();
          }
        }
      }

      // Make functions globally accessible for onclick handlers
      window.toggleHomeOfficeMethod = toggleHomeOfficeMethod;
      window.calculateHomeOffice = calculateHomeOffice;
      window.resetHomeOffice = resetHomeOffice;
      window.compareBothHomeOfficeMethods = compareBothHomeOfficeMethods;

      function calculateQuarterly() {
        const i = parseFloat(document.getElementById('estimatedIncome').value) || 0;
        const b =
          DriverCalculator.TAX_BRACKETS.find((x) => i <= x.max) || DriverCalculator.TAX_BRACKETS[5];
        const t = i * b.rate;
        const r = DriverCalculator.calculateQuarterlyInstallments(t, i);
        document.getElementById('quarterlyResults').style.display = 'block';
        ['q1', 'q2', 'q3', 'q4'].forEach(
          (q) =>
            (document.getElementById(q + 'Amount').textContent = '$' + r.quarterly.toLocaleString())
        );
        document.getElementById('weeklyAmount').textContent = '$' + r.weekly.toLocaleString();
        document.getElementById('annualTotal').textContent = '$' + r.annualTax.toLocaleString();
      }
      function calculateSelfEmploy() {
        const i = parseFloat(document.getElementById('selfEmployIncome').value) || 0;
        const r = DriverCalculator.calculateSelfEmploymentTax(i);
        document.getElementById('selfEmployResults').style.display = 'block';
        document.getElementById('qppTotal').textContent =
          '$' + r.totalContribution.toLocaleString();
        document.getElementById('qppDeductible').textContent =
          '$' + r.deductiblePortion.toLocaleString();
        document.getElementById('qppNetCost').textContent = '$' + r.netCost.toLocaleString();
      }

      // Document Processing Functions
      function processDocumentText() {
        const textarea = document.getElementById('documentText');
        
        if (!textarea) {
          console.error('Textarea element not found');
          alert('Error: Text input not found. Please refresh the page.');
          return;
        }
        
        const text = textarea.value.trim();

        if (!text) {
          alert('Please enter document text');
          return;
        }

        // Show processing status
        showProcessingStatus('üìÑ Reading document...');

        setTimeout(() => {
          showProcessingStatus('üîç Extracting data...');

          setTimeout(() => {
            showProcessingStatus('üßÆ Calculating tax impact...');

            setTimeout(() => {
              try {
                // Process the document
                const result = DocumentAutomation.processDocument(text);

                // Hide processing status
                const statusEl = document.getElementById('processingStatus');
                if (statusEl) {
                  statusEl.style.display = 'none';
                }

                if (result.success) {
                  displayDocumentResults(result);
                  showProcessingStatus('‚úÖ Complete! Document processed successfully');
                  setTimeout(() => {
                    if (statusEl) {
                      statusEl.style.display = 'none';
                    }
                  }, 2000);
                } else {
                  alert('Error: ' + (result.error || 'Unable to process document'));
                  console.error('Processing failed:', result);
                }
              } catch (error) {
                console.error('Error processing document:', error);
                alert('Error processing document: ' + error.message);
                const statusEl = document.getElementById('processingStatus');
                if (statusEl) {
                  statusEl.style.display = 'none';
                }
              }
            }, 500);
          }, 500);
        }, 500);
      }

      function showProcessingStatus(message) {
        const statusEl = document.getElementById('processingStatus');
        const textEl = document.getElementById('statusText');
        const iconEl = document.getElementById('statusIcon');

        statusEl.style.display = 'block';
        textEl.textContent = message;

        if (message.includes('‚úÖ')) {
          iconEl.textContent = '‚úÖ';
        } else if (message.includes('üìÑ')) {
          iconEl.textContent = 'üìÑ';
        } else if (message.includes('üîç')) {
          iconEl.textContent = 'üîç';
        } else if (message.includes('üßÆ')) {
          iconEl.textContent = 'üßÆ';
        } else {
          iconEl.textContent = '‚è≥';
        }
      }

      function displayDocumentResults(result) {
        // Validate result object
        if (!result || typeof result !== 'object') {
          console.error('Invalid result object:', result);
          return;
        }

        // Get required elements with null checks
        const documentResults = document.getElementById('documentResults');
        const docType = document.getElementById('docType');
        const docConfidence = document.getElementById('docConfidence');
        const extractedData = document.getElementById('extractedData');
        const categoryName = document.getElementById('categoryName');
        const amountLabel = document.getElementById('amountLabel');
        const categoryAmount = document.getElementById('categoryAmount');
        const deductionItem = document.getElementById('deductionItem');
        const savingsItem = document.getElementById('savingsItem');
        const deductibleAmount = document.getElementById('deductibleAmount');
        const taxSavings = document.getElementById('taxSavings');
        const warningsSection = document.getElementById('warningsSection');
        const warningsList = document.getElementById('warningsList');

        // Check if all required elements exist
        if (!documentResults) {
          console.error('documentResults element not found');
          return;
        }

        // Show results section
        documentResults.style.display = 'block';

        // Display document type and confidence
        if (docType) {
          docType.textContent = result.type ? result.type.replace(/_/g, ' ') : 'Unknown Document';
        }
        
        if (docConfidence) {
          const confidence = result.confidence || 0;
          docConfidence.textContent = (confidence * 100).toFixed(0) + '%';
          
          // Update confidence badge styling based on level
          if (confidence > 0.8) {
            docConfidence.style.background = 'rgba(16, 185, 129, 0.1)';
            docConfidence.style.color = 'var(--success)';
          } else if (confidence > 0.5) {
            docConfidence.style.background = 'rgba(245, 158, 11, 0.1)';
            docConfidence.style.color = 'var(--warning)';
          } else {
            docConfidence.style.background = 'rgba(239, 68, 68, 0.1)';
            docConfidence.style.color = 'var(--danger)';
          }
        }

        // Display extracted data
        if (extractedData) {
          // Use extractedData field from quickProcess or data field from DocumentAutomation
          const dataToDisplay = result.extractedData || result.data || {};
          extractedData.textContent = JSON.stringify(dataToDisplay, null, 2);
        }

        // Display category information
        const category = result.category || {};
        
        if (categoryName) {
          categoryName.textContent = category.category?.replace(/_/g, ' ') || 'N/A';
        }

        // Set amount label based on type
        if (amountLabel) {
          if (category.type === 'income') {
            amountLabel.textContent = 'Income Amount:';
          } else {
            amountLabel.textContent = 'Expense Amount:';
          }
        }

        if (categoryAmount) {
          categoryAmount.textContent = '$' + (category.amount || 0).toLocaleString();
        }

        // Show/hide deduction and savings for expenses
        if (category.type === 'expense') {
          if (deductionItem) {
            deductionItem.style.display = 'block';
          }
          if (savingsItem) {
            savingsItem.style.display = 'block';
          }
          if (deductibleAmount) {
            deductibleAmount.textContent = '$' + (category.deductibleAmount || 0).toLocaleString();
          }
          if (taxSavings) {
            taxSavings.textContent = '$' + (category.taxSavings || 0);
          }
        } else {
          if (deductionItem) {
            deductionItem.style.display = 'none';
          }
          if (savingsItem) {
            savingsItem.style.display = 'none';
          }
        }

        // Display warnings if any
        if (result.warnings && result.warnings.length > 0) {
          if (warningsSection) {
            warningsSection.style.display = 'block';
          }
          if (warningsList) {
            warningsList.innerHTML = '';
            result.warnings.forEach((warning) => {
              const li = document.createElement('li');
              li.textContent = warning;
              warningsList.appendChild(li);
            });
          }
        } else {
          if (warningsSection) {
            warningsSection.style.display = 'none';
          }
        }

        // Display T4A card if applicable
        displayT4ACard(result);

        // Switch to results tab
        switchAITab('results');

        // Scroll to results
        documentResults.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
      }

      function clearDocumentForm() {
        const documentText = document.getElementById('documentText');
        const documentResults = document.getElementById('documentResults');
        const processingStatus = document.getElementById('processingStatus');
        
        if (documentText) {
          documentText.value = '';
        }
        if (documentResults) {
          documentResults.style.display = 'none';
        }
        if (processingStatus) {
          processingStatus.style.display = 'none';
        }
      }

      // File upload handling
      const fileInput = document.getElementById('fileInput');
      const dropZone = document.getElementById('dropZone');

      if (fileInput) {
        fileInput.addEventListener('change', handleFileSelect);
      }

      if (dropZone) {
        dropZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          dropZone.style.borderColor = 'var(--accent)';
          dropZone.style.background = 'var(--accent-light)';
        });

        dropZone.addEventListener('dragleave', (e) => {
          e.preventDefault();
          dropZone.style.borderColor = 'var(--border)';
          dropZone.style.background = '#fff';
        });

        dropZone.addEventListener('drop', (e) => {
          e.preventDefault();
          dropZone.style.borderColor = 'var(--border)';
          dropZone.style.background = '#fff';

          const files = e.dataTransfer.files;
          if (files.length > 0) {
            handleFiles(files);
          }
        });
      }

      function handleFileSelect(e) {
        const files = e.target.files;
        if (files.length > 0) {
          handleFiles(files);
        }
      }

      function handleFiles(files) {
        const file = files[0];
        const fileName = file.name;
        const fileExt = fileName.split('.').pop().toLowerCase();

        if (fileExt === 'txt') {
          // Read text file
          const reader = new FileReader();
          reader.onload = function (e) {
            const text = e.target.result;
            document.getElementById('documentText').value = text;
            processDocumentText();
          };
          reader.readAsText(file);
        } else if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'bmp'].includes(fileExt)) {
          // Image file - show helpful message
          showProcessingStatus('üì∏ Image uploaded! OCR processing requires additional library (Tesseract.js).');
          setTimeout(() => {
            showProcessingStatus('üí° For now, please extract text from your image and paste it in the text area below.');
            setTimeout(() => {
              document.getElementById('processingStatus').style.display = 'none';
            }, 3000);
          }, 2000);
        } else {
          // Unsupported file type
          showProcessingStatus('‚ö†Ô∏è Unsupported file type. Please use images or text files.');
          setTimeout(() => {
            document.getElementById('processingStatus').style.display = 'none';
          }, 3000);
        }
      }

      // Document AI Hub Tab Switching
      document.addEventListener('DOMContentLoaded', function () {
        // Initialize AI tab switching
        document.querySelectorAll('.ai-tab-btn').forEach((btn) => {
          btn.addEventListener('click', function () {
            const tabId = this.getAttribute('data-tab');
            switchAITab(tabId);
          });
        });
      });

      function switchAITab(tabId) {
        // Remove active class from all AI tabs and panels
        document.querySelectorAll('.ai-tab-btn').forEach((btn) => btn.classList.remove('active'));
        document
          .querySelectorAll('.ai-tab-panel')
          .forEach((panel) => panel.classList.remove('active'));

        // Add active class to selected tab and panel
        const selectedBtn = document.querySelector(`[data-tab="${tabId}"]`);
        const selectedPanel = document.getElementById(tabId);

        if (selectedBtn) selectedBtn.classList.add('active');
        if (selectedPanel) selectedPanel.classList.add('active');
      }

      // Email address copy functionality
      function copyEmailAddress(event) {
        const email = 'notifications@isaloumapps.com';
        navigator.clipboard
          .writeText(email)
          .then(() => {
            const btn = event.target.closest('.copy-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = '‚úÖ <span data-i18n="documentAI.copied">Copied!</span>';
            setTimeout(() => (btn.innerHTML = originalText), 2000);
          })
          .catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = email;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Email address copied: ' + email);
          });
      }

      // Camera functionality
      let cameraStream = null;

      async function startCamera() {
        try {
          const video = document.getElementById('cameraPreview');
          const btn = document.getElementById('cameraBtn');

          cameraStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'environment' },
          });

          video.srcObject = cameraStream;
          video.style.display = 'block';
          video.play();

          // Update button to show capture option
          btn.textContent = 'üì∏ Capture Photo';
          btn.onclick = capturePhoto;

          // Add close button
          const closeBtn = document.createElement('button');
          closeBtn.className = 'btn btn-secondary';
          closeBtn.innerHTML = '‚úñ <span data-i18n="documentAI.closeCamera">Close Camera</span>';
          closeBtn.onclick = stopCamera;
          closeBtn.style.marginLeft = '10px';
          btn.parentNode.appendChild(closeBtn);
        } catch (error) {
          console.error('Camera error:', error);
          alert('Camera access denied or not available. Please check your device permissions.');
        }
      }

      function stopCamera() {
        if (cameraStream) {
          cameraStream.getTracks().forEach((track) => track.stop());
          cameraStream = null;
        }
        const video = document.getElementById('cameraPreview');
        video.style.display = 'none';
        video.srcObject = null;

        // Reset button
        const btn = document.getElementById('cameraBtn');
        btn.innerHTML = 'üì∑ <span data-i18n="documentAI.scanReceipt">Scan Receipt</span>';
        btn.onclick = startCamera;

        // Remove close button
        const closeBtn = btn.parentNode.querySelector('.btn-secondary');
        if (closeBtn) closeBtn.remove();
      }

      function capturePhoto() {
        const video = document.getElementById('cameraPreview');
        const canvas = document.getElementById('captureCanvas');
        const context = canvas.getContext('2d');

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0);

        // Convert canvas to blob and process
        canvas.toBlob((blob) => {
          stopCamera();
          alert(
            'Photo captured! OCR processing requires Tesseract.js library. For now, please use the text input method or upload a text file.'
          );
          // In a real implementation, you would process the image with OCR here
        });
      }

      // File upload functionality
      function triggerFileSelect() {
        document.getElementById('fileInput').click();
      }

      setLang('fr');
    </script>
    <script type="module">
      // Import document processing modules
      import { quickProcess } from './document-processor.js';
      import { 
        calculateSimplifiedHomeOffice,
        calculateDetailedHomeOffice,
        compareHomeOfficeMethods
      } from './home-office-calculator.js';

      // Make home office calculator functions globally available
      window.calculateSimplifiedHomeOffice = calculateSimplifiedHomeOffice;
      window.calculateDetailedHomeOffice = calculateDetailedHomeOffice;
      window.compareHomeOfficeMethods = compareHomeOfficeMethods;

      // Global state for document processing
      let processedDocuments = [];
      let lastProcessedFile = { name: '', time: 0 };

      // Drag and drop functionality
      const uploadZone = document.getElementById('uploadZone');
      const fileInput = document.getElementById('fileInput');

      if (uploadZone) {
        uploadZone.addEventListener('click', () => {
          console.log('üìÅ Opening file picker...');
          fileInput.click();
        });

        uploadZone.addEventListener('dragover', (e) => {
          e.preventDefault();
          uploadZone.classList.add('drag-over');
        });

        uploadZone.addEventListener('dragleave', () => {
          uploadZone.classList.remove('drag-over');
        });

        uploadZone.addEventListener('drop', async (e) => {
          e.preventDefault();
          uploadZone.classList.remove('drag-over');
          const files = Array.from(e.dataTransfer.files);
          await processFiles(files);
        });
      }

      if (fileInput) {
        console.log('‚úÖ File input listener attached');
        fileInput.addEventListener('change', async (e) => {
          console.log('üî• File input change event fired with', e.target.files.length, 'files');
          const files = Array.from(e.target.files);
          await processFiles(files);
          // Clear file input to ensure change event fires again for same file
          fileInput.value = '';
        });
      }

      /**
       * Display error message to user
       */
      function showUploadError(fileName, errorMessage) {
        const errorDiv = document.createElement('div');
        errorDiv.style.cssText = 'background: #fee; border: 1px solid #fcc; padding: 1rem; border-radius: 8px; margin: 1rem 0; color: #c00;';
        errorDiv.innerHTML = `
          <strong>‚ùå Error processing ${fileName}</strong>
          <br><small>${errorMessage}</small>
          ${errorMessage.includes('image-based') ? '<br><br><em>üí° Tip: Try copying the text from the PDF and pasting it in the text area below.</em>' : ''}
        `;
        
        const uploadZone = document.getElementById('uploadZone');
        if (uploadZone && uploadZone.parentNode) {
          uploadZone.parentNode.insertBefore(errorDiv, uploadZone.nextSibling);
          
          // Auto-remove after 8 seconds
          setTimeout(() => errorDiv.remove(), 8000);
        }
      }

      /**
       * Extract text from PDF file using PDF.js
       * @param {File} file - The PDF file to extract text from
       * @returns {Promise<string>} - Extracted text content
       */
      async function extractTextFromPDF(file) {
        try {
          const arrayBuffer = await file.arrayBuffer();
          const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
          let fullText = '';
          
          // Extract text from each page
          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
            const page = await pdf.getPage(pageNum);
            const textContent = await page.getTextContent();
            const pageText = textContent.items.map(item => item.str).join(' ');
            fullText += pageText + '\n';
          }
          
          return fullText.trim();
        } catch (error) {
          console.error('Error extracting text from PDF:', error);
          throw new Error('Failed to extract text from PDF: ' + error.message);
        }
      }

      // Process uploaded files
      async function processFiles(files) {
        if (files.length === 0) return;

        console.log('processFiles called with', files.length, 'file(s)');
        
        // Check for duplicate processing within 2 seconds
        if (files.length === 1) {
          const file = files[0];
          const now = Date.now();
          if (file.name === lastProcessedFile.name && (now - lastProcessedFile.time) < 2000) {
            console.log('‚ö†Ô∏è Duplicate file processing detected within 2 seconds, skipping:', file.name);
            return;
          }
          lastProcessedFile = { name: file.name, time: now };
        }
        
        showProcessingStatus(true);
        const results = [];

        for (const file of files) {
          try {
            console.log('Processing file:', file.name, 'type:', file.type);
            let text = '';
            
            // Check if file is PDF
            if (file.type === 'application/pdf' || file.name.toLowerCase().endsWith('.pdf')) {
              // Extract text from PDF using PDF.js
              console.log('Processing PDF:', file.name);
              text = await extractTextFromPDF(file);
              
              if (!text || text.trim().length === 0) {
                throw new Error('No text could be extracted from this PDF. It may be an image-based PDF.');
              }
            } else {
              // Read text file normally
              text = await readFileAsText(file);
            }
            
            console.log('Extracted text length:', text?.length || 0);
            
            // Process the extracted text
            const result = quickProcess(text);
            result.fileName = file.name;
            
            console.log('Processing result:', { 
              success: result.success, 
              documentType: result.documentType,
              error: result.error 
            });
            
            results.push(result);
            
          } catch (error) {
            console.error('Error processing file:', file.name, error);
            
            // Show user-friendly error message
            showUploadError(file.name, error.message);
            
            results.push({
              success: false,
              fileName: file.name,
              error: error.message,
              documentType: 'UNKNOWN',
              extractedData: {},
              validation: {
                isValid: false,
                errors: [error.message],
                warnings: [],
                confidenceScore: 0,
              },
            });
          }
        }

        console.log('Total results:', results.length);
        processedDocuments = processedDocuments.concat(results);
        showProcessingStatus(false);
        displayResults(results);
      }

      // Read file as text
      function readFileAsText(file) {
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onload = (e) => resolve(e.target.result);
          reader.onerror = () => reject(new Error('Failed to read file'));
          reader.readAsText(file);
        });
      }

      // Process text input
      window.processText = function () {
        const text = document.getElementById('documentText').value;
        console.log('processText called, text length:', text?.length || 0);
        
        if (!text.trim()) {
          alert('Veuillez entrer du texte √† traiter');
          return;
        }

        showProcessingStatus(true);
        setTimeout(() => {
          try {
            console.log('Processing text input...');
            const result = quickProcess(text);
            result.fileName = 'Texte saisi manuellement';
            
            console.log('Text processing result:', {
              success: result.success,
              documentType: result.documentType,
              error: result.error
            });
            
            processedDocuments.push(result);
            showProcessingStatus(false);
            displayResults([result]);
            document.getElementById('documentText').value = '';
          } catch (error) {
            console.error('Error in processText:', error);
            showProcessingStatus(false);
            alert('Erreur lors du traitement: ' + error.message);
          }
        }, 500);
      };

      // Camera functions
      let cameraStream = null;

      window.openCamera = async function () {
        try {
          const cameraCapture = document.getElementById('cameraCapture');
          const video = document.getElementById('cameraPreview');

          cameraStream = await navigator.mediaDevices.getUserMedia({
            video: { facingMode: 'environment' },
          });
          video.srcObject = cameraStream;
          cameraCapture.style.display = 'block';
          dropZone.style.display = 'none';
        } catch (error) {
          console.error('Camera error:', error);
          alert("Impossible d'acc√©der √† la cam√©ra. Veuillez v√©rifier les permissions.");
        }
      };

      window.closeCamera = function () {
        if (cameraStream) {
          cameraStream.getTracks().forEach((track) => track.stop());
          cameraStream = null;
        }
        document.getElementById('cameraCapture').style.display = 'none';
        dropZone.style.display = 'block';
      };

      window.capturePhoto = function () {
        const video = document.getElementById('cameraPreview');
        const canvas = document.getElementById('cameraCanvas');
        const context = canvas.getContext('2d');

        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        context.drawImage(video, 0, 0);

        // Convert canvas to blob and process
        canvas.toBlob(async (blob) => {
          closeCamera();
          alert(
            'Photo captur√©e! Le traitement OCR n√©cessite une biblioth√®que suppl√©mentaire (Tesseract.js) non encore int√©gr√©e. Veuillez utiliser le texte manuel pour le moment.'
          );
        });
      };

      // Show/hide processing status
      function showProcessingStatus(show) {
        const status = document.getElementById('processingStatus');
        if (status) {
          status.style.display = show ? 'block' : 'none';
        }
      }

      // Display processing results
      function displayResults(results) {
        const container = document.getElementById('documentHistory');
        const resultsDiv = document.getElementById('documentResultsDisplay');
        
        if (!container) {
          console.error('Results container not found!');
          return;
        }

        // Clear "no documents" message
        const noDocsMsg = container.querySelector('.no-documents');
        if (noDocsMsg) noDocsMsg.remove();

        // Add each result card
        results.forEach((result) => {
          const card = createDocumentCard(result);
          container.appendChild(card);
        });

        // Update Tax Impact Summary
        updateTaxImpactSummary();

        // Switch to results tab and scroll
        switchAITab('results');
        if (resultsDiv) {
          resultsDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }
      }

      // Create a document card for display
      function createDocumentCard(result) {
        const card = document.createElement('div');
        card.className = 'document-card';

        // Header
        const header = document.createElement('div');
        header.className = 'document-card-header';

        const typeDiv = document.createElement('div');
        typeDiv.className = 'document-type';
        typeDiv.textContent =
          result.documentType + (result.fileName ? ` - ${result.fileName}` : '');

        const badge = document.createElement('span');
        badge.className = 'confidence-badge';
        if (result.validation && result.validation.confidenceScore) {
          const score = result.validation.confidenceScore;
          badge.textContent = `${score}% confiance`;
          badge.classList.add(
            score >= 80 ? 'confidence-high' : score >= 50 ? 'confidence-medium' : 'confidence-low'
          );
        } else {
          badge.textContent = result.success ? '‚úì Trait√©' : '‚úó √âchec';
          badge.classList.add(result.success ? 'confidence-high' : 'confidence-low');
        }

        header.appendChild(typeDiv);
        header.appendChild(badge);
        card.appendChild(header);

        // Error message if failed
        if (!result.success && result.error) {
          const errorDiv = document.createElement('div');
          errorDiv.style.padding = '1rem';
          errorDiv.style.background = 'rgba(239, 68, 68, 0.05)';
          errorDiv.style.border = '1px solid var(--danger)';
          errorDiv.style.borderRadius = '6px';
          errorDiv.style.color = 'var(--danger)';
          errorDiv.textContent = '‚ö†Ô∏è ' + result.error;
          card.appendChild(errorDiv);
          return card;
        }

        // Extracted fields
        if (result.extractedData && Object.keys(result.extractedData).length > 0) {
          const fieldsDiv = document.createElement('div');
          fieldsDiv.className = 'extracted-fields';

          Object.entries(result.extractedData).forEach(([key, value]) => {
            const fieldItem = document.createElement('div');
            fieldItem.className = 'field-item';

            const label = document.createElement('div');
            label.className = 'field-label';
            label.textContent = formatFieldName(key);

            const valueDiv = document.createElement('div');
            valueDiv.className = 'field-value';
            valueDiv.textContent = formatFieldValue(value);

            fieldItem.appendChild(label);
            fieldItem.appendChild(valueDiv);
            fieldsDiv.appendChild(fieldItem);
          });

          card.appendChild(fieldsDiv);
        }

        // Warnings
        if (
          result.validation &&
          result.validation.warnings &&
          result.validation.warnings.length > 0
        ) {
          const warningsDiv = document.createElement('div');
          warningsDiv.className = 'validation-warnings';

          const title = document.createElement('strong');
          title.textContent = '‚ö†Ô∏è Avertissements:';
          warningsDiv.appendChild(title);

          result.validation.warnings.forEach((warning) => {
            const item = document.createElement('div');
            item.className = 'warning-item';
            item.textContent = '‚Ä¢ ' + warning;
            warningsDiv.appendChild(item);
          });

          card.appendChild(warningsDiv);
        }

        return card;
      }

      // Format field names for display
      function formatFieldName(name) {
        const nameMap = {
          employmentIncome: "Revenu d'emploi",
          cpp: 'CPP',
          qpp: 'RRQ',
          ei: 'AE',
          ppip: 'RPAP',
          incomeTax: 'Imp√¥t retenu',
          grossFares: 'Revenus bruts',
          tips: 'Pourboires',
          distance: 'Distance (km)',
          total: 'Total',
          date: 'Date',
          vendor: 'Fournisseur',
          station: 'Station',
          liters: 'Litres',
        };
        return nameMap[name] || name;
      }

      // Format field values for display
      function formatFieldValue(value) {
        if (typeof value === 'number') {
          return (
            '$' +
            value.toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 })
          );
        }
        return value;
      }

      // Update Tax Impact Summary based on all processed documents
      function updateTaxImpactSummary() {
        let totalIncome = 0;
        let totalDeductions = 0;
        const VEHICLE_DEDUCTION_RATE_2026 = 0.70; // $0.70 per km for first 5,000 km
        const MARGINAL_TAX_RATE = 0.44; // Approximate 44% marginal rate for Quebec

        // Calculate totals from all processed documents
        processedDocuments.forEach((doc) => {
          if (!doc.success || !doc.extractedData) return;

          const data = doc.extractedData;
          const docType = doc.documentType;

          // Income from rideshare platforms
          if (docType === 'UBER_SUMMARY' || docType === 'LYFT_SUMMARY' || docType === 'TAXI_STATEMENT') {
            const grossFares = data.grossFares || data.grossEarnings || data.grossIncome || 0;
            const tips = data.tips || 0;
            const tolls = data.tolls || 0;
            totalIncome += grossFares + tips + tolls;

            // Calculate vehicle deduction from distance
            if (data.distance) {
              const deduction = data.distance * VEHICLE_DEDUCTION_RATE_2026;
              totalDeductions += deduction;
            }
          }

          // Employment income from T4/RL1
          if (docType === 'T4' || docType === 'RL-1' || docType === 'T4A' || docType === 'RL-2') {
            const employmentIncome = data.employmentIncome || 0;
            totalIncome += employmentIncome;
          }

          // Expense receipts
          if (docType === 'GAS_RECEIPT' || docType === 'MAINTENANCE_RECEIPT' || 
              docType === 'PARKING_RECEIPT' || docType === 'PHONE_BILL') {
            const amount = data.total || data.amount || 0;
            // Apply business use percentage (80% for most vehicle expenses)
            const businessPortion = amount * 0.8;
            totalDeductions += businessPortion;
          }
        });

        // Calculate tax savings
        const taxSavings = totalDeductions * MARGINAL_TAX_RATE;

        // Update the UI
        const totalIncomeEl = document.getElementById('totalIncome');
        const totalDeductionsEl = document.getElementById('totalDeductions');
        const totalSavingsEl = document.getElementById('totalSavings');

        if (totalIncomeEl) {
          totalIncomeEl.textContent = '$' + totalIncome.toLocaleString('fr-CA', { 
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2 
          });
        }

        if (totalDeductionsEl) {
          totalDeductionsEl.textContent = '$' + totalDeductions.toLocaleString('fr-CA', { 
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2 
          });
        }

        if (totalSavingsEl) {
          totalSavingsEl.textContent = '$' + taxSavings.toLocaleString('fr-CA', { 
            minimumFractionDigits: 2, 
            maximumFractionDigits: 2 
          });
        }
        
        // Check GST/HST threshold
        checkGSTHSTThreshold();
      }

      const GST_HST_THRESHOLD = 30000;
      const CRA_AUDIT_RISK_THRESHOLD = 90;

      function calculateYTDIncome() {
        let ytdIncome = 0;
        
        // Aggregate income from all processed documents
        if (window.processedDocuments) {
          processedDocuments.forEach(doc => {
            if (!doc.success || !doc.extractedData) return;
            
            const data = doc.extractedData;
            ytdIncome += data.grossFares || 0;
            ytdIncome += data.tips || 0;
            ytdIncome += data.employmentIncome || 0;
            ytdIncome += data.grossIncome || 0;
          });
        }
        
        return ytdIncome;
      }

      function checkGSTHSTThreshold() {
        const ytdIncome = calculateYTDIncome();
        
        const warningBanner = document.getElementById('gstHstWarning');
        const warningMessage = document.getElementById('gstWarningMessage');
        
        if (!warningBanner || !warningMessage) return;
        
        if (ytdIncome >= GST_HST_THRESHOLD * 0.8) {
          warningBanner.style.display = 'block';
          const percentOfThreshold = (ytdIncome / GST_HST_THRESHOLD * 100).toFixed(1);
          
          if (ytdIncome >= GST_HST_THRESHOLD) {
            warningMessage.innerHTML = `
              <strong>üö® You've exceeded the $30,000 GST/HST threshold!</strong><br>
              Your YTD gross income: <strong>$${ytdIncome.toLocaleString()}</strong> (${percentOfThreshold}% of threshold)<br>
              <em>You are required to register for GST/HST. Failure to register may result in penalties.</em>
            `;
            warningBanner.style.backgroundColor = '#f8d7da';
            warningBanner.style.borderColor = '#dc3545';
          } else if (ytdIncome >= GST_HST_THRESHOLD * 0.9) {
            warningMessage.innerHTML = `
              <strong>‚ö†Ô∏è Approaching GST/HST threshold</strong><br>
              Your YTD gross income: <strong>$${ytdIncome.toLocaleString()}</strong> (${percentOfThreshold}% of $30,000)<br>
              <em>Prepare to register for GST/HST soon. Registration required after $30,000.</em>
            `;
          } else {
            warningMessage.innerHTML = `
              <strong>‚ÑπÔ∏è Heads up!</strong><br>
              Your YTD gross income: <strong>$${ytdIncome.toLocaleString()}</strong> (${percentOfThreshold}% of $30,000 threshold)<br>
              <em>You're getting close to the GST/HST registration threshold.</em>
            `;
          }
        } else {
          warningBanner.style.display = 'none';
        }
      }

      function calculateOdometer() {
        const start = parseFloat(document.getElementById('odometerStart').value) || 0;
        const end = parseFloat(document.getElementById('odometerEnd').value) || 0;
        const businessKm = parseFloat(document.getElementById('businessKmInput').value) || 0;
        
        if (start === 0 || end === 0) {
          alert('Please enter both start and end odometer readings');
          return;
        }
        
        if (end <= start) {
          alert('End odometer must be greater than start odometer');
          return;
        }
        
        const totalKm = end - start;
        
        // Validate business km doesn't exceed total km
        if (businessKm > totalKm) {
          alert(`Business kilometers (${businessKm}) cannot exceed total kilometers (${totalKm})`);
          return;
        }
        
        const personalKm = totalKm - businessKm;
        const businessPercent = ((businessKm / totalKm) * 100).toFixed(1);
        
        // Display summary
        document.getElementById('odometerSummary').style.display = 'block';
        document.getElementById('totalKmDriven').textContent = totalKm.toLocaleString();
        document.getElementById('businessKmPercent').textContent = businessKm.toLocaleString();
        document.getElementById('businessPercent').textContent = businessPercent;
        document.getElementById('personalKm').textContent = personalKm.toLocaleString();
        
        // Auto-populate the simplified method calculation
        const totalKmField = document.getElementById('totalKm');
        if (totalKmField) {
          totalKmField.value = businessKm;
        }
        
        // CRA audit warning for high business use
        if (businessPercent > CRA_AUDIT_RISK_THRESHOLD) {
          alert(
            `‚ö†Ô∏è Warning: ${businessPercent}% business use may trigger CRA review.\n\n` +
            `The CRA typically scrutinizes business use claims above ${CRA_AUDIT_RISK_THRESHOLD}%.\n\n` +
            `Ensure you have detailed trip logs to support this claim.`
          );
        }
        
        // Save odometer data for export
        if (!window.odometerData) window.odometerData = {};
        window.odometerData = {
          startReading: start,
          endReading: end,
          totalKm: totalKm,
          businessKm: businessKm,
          personalKm: personalKm,
          businessPercent: parseFloat(businessPercent),
          recordedDate: new Date().toISOString()
        };
      }

      // T4A Display Handler
      function displayT4ACard(result) {
        const t4aCard = document.getElementById('t4aCard');
        if (!t4aCard) return;

        const data = result.extractedData || result.data || {};
        
        // Check if this is a T4A document
        if (result.type === 'T4A' || result.documentType === 'T4A') {
          t4aCard.style.display = 'block';
          
          // Populate T4A fields using correct property names from extractT4A
          document.getElementById('t4aPayerName').textContent = data.payerName || 'N/A';
          document.getElementById('t4aBox048').textContent = '$' + (data.feesForServices || 0).toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          document.getElementById('t4aBox020').textContent = '$' + (data.commissions || 0).toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          document.getElementById('t4aBox028').textContent = '$' + (data.otherIncome || 0).toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          document.getElementById('t4aBox022').textContent = '$' + (data.incomeTaxDeducted || 0).toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
          
          // Calculate total income (or use pre-calculated value)
          const totalIncome = data.totalIncome || ((data.feesForServices || 0) + (data.commissions || 0) + (data.otherIncome || 0));
          document.getElementById('t4aTotalIncome').textContent = '$' + totalIncome.toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        } else {
          t4aCard.style.display = 'none';
        }
      }

      // Business Expense Functions
      function addManualExpense() {
        const date = document.getElementById('expenseDate').value;
        const vendor = document.getElementById('expenseVendor').value;
        const category = document.getElementById('expenseCategory').value;
        const amount = parseFloat(document.getElementById('expenseAmount').value);
        const description = document.getElementById('expenseDescription').value;

        if (!date || !vendor || !amount || amount <= 0) {
          alert('Please fill in all required fields (Date, Vendor, Amount)');
          return;
        }

        // CRA REQUIREMENT: Receipt mandatory for expenses >$75
        if (amount > 75) {
          const hasReceipt = confirm(
            `‚ö†Ô∏è CRA Requirement: Expenses over $75 require a receipt.\n\n` +
            `Amount: $${amount.toFixed(2)}\n\n` +
            `Do you have a receipt attached or will you upload one now?\n\n` +
            `Click OK to proceed (you'll need to attach receipt), or Cancel to go back.`
          );
          
          if (!hasReceipt) {
            alert('‚ùå Please attach a receipt before adding this expense.\n\nExpenses >$75 without receipts may be rejected during a CRA audit.');
            return;
          }
        }

        // Add expense using the tracker
        if (window.expenseTracker) {
          const expense = window.expenseTracker.addExpense({
            date,
            vendor,
            category,
            amount,
            description,
            requiresReceipt: amount > 75,
            hasReceipt: false // Mark as false until receipt is uploaded
          });

          // Clear form
          document.getElementById('expenseDate').value = '';
          document.getElementById('expenseVendor').value = '';
          document.getElementById('expenseAmount').value = '';
          document.getElementById('expenseDescription').value = '';
          document.getElementById('expenseCategory').value = 'VEHICLE';

          // Update summary
          updateExpenseSummary();

          if (amount > 75) {
            alert('‚úÖ Expense added!\n\n‚ö†Ô∏è Remember to upload receipt for CRA audit compliance.');
          } else {
            alert('‚úÖ Expense added successfully!');
          }
        }
      }

      function updateExpenseSummary() {
        if (!window.expenseTracker) return;

        const tracker = window.expenseTracker;
        const expenses = tracker.expenses;

        // Update totals
        const totalReceipts = expenses.length;
        const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
        const totalDeductible = expenses.reduce((sum, exp) => sum + exp.deductibleAmount, 0);

        document.getElementById('totalReceipts').textContent = totalReceipts;
        document.getElementById('totalExpenses').textContent = '$' + totalExpenses.toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        document.getElementById('totalDeductible').textContent = '$' + totalDeductible.toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 });

        // Update category breakdown table
        const categoryBreakdownBody = document.getElementById('categoryBreakdownBody');
        categoryBreakdownBody.innerHTML = '';

        if (expenses.length === 0) {
          categoryBreakdownBody.innerHTML = '<tr><td colspan="5" style="padding: 1rem; text-align: center; color: var(--muted);">No expenses added yet</td></tr>';
          return;
        }

        // Group expenses by category
        const categoryGroups = {};
        expenses.forEach(exp => {
          if (!categoryGroups[exp.category]) {
            categoryGroups[exp.category] = {
              count: 0,
              totalAmount: 0,
              totalDeductible: 0,
            };
          }
          categoryGroups[exp.category].count++;
          categoryGroups[exp.category].totalAmount += exp.amount;
          categoryGroups[exp.category].totalDeductible += exp.deductibleAmount;
        });

        // Render table rows
        Object.keys(categoryGroups).forEach(categoryKey => {
          const categoryInfo = window.EXPENSE_CATEGORIES[categoryKey];
          const group = categoryGroups[categoryKey];
          
          const row = document.createElement('tr');
          row.style.borderBottom = '1px solid var(--border)';
          row.innerHTML = `
            <td style="padding: 0.75rem;">${categoryInfo.label}</td>
            <td style="padding: 0.75rem; text-align: center;">${categoryInfo.code}</td>
            <td style="padding: 0.75rem; text-align: center;">${group.count}</td>
            <td style="padding: 0.75rem; text-align: right;">$${group.totalAmount.toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
            <td style="padding: 0.75rem; text-align: right; font-weight: 600; color: var(--success);">$${group.totalDeductible.toLocaleString('fr-CA', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}</td>
          `;
          categoryBreakdownBody.appendChild(row);
        });
        
        // Add missing receipts warning
        const missingReceipts = tracker.expenses.filter(e => e.amount > 75 && !e.hasReceipt && !e.receiptImage);

        if (missingReceipts.length > 0) {
          const warningHtml = `
            <div class="alert alert-warning" style="margin-top: 1rem; padding: 1rem; background: #fff3cd; border: 2px solid #ffc107; border-radius: 8px;">
              <h4 style="margin-top: 0; color: #856404;">üìã Missing Receipts</h4>
              <p><strong>${missingReceipts.length}</strong> expense(s) over $75 are missing receipts:</p>
              <ul style="margin: 0.5rem 0;">
                ${missingReceipts.map(e => `
                  <li>$${e.amount.toFixed(2)} - ${e.vendor} (${e.date})</li>
                `).join('')}
              </ul>
              <p style="margin-bottom: 0;"><em>‚ö†Ô∏è CRA requires receipts for expenses over $75. Missing receipts may be rejected in an audit.</em></p>
            </div>
          `;
          
          document.getElementById('expenseSummary').insertAdjacentHTML('beforeend', warningHtml);
        }
      }

      function exportToT2125JSON() {
        if (!window.expenseTracker) return;

        const tracker = window.expenseTracker;
        const t2125Data = tracker.exportForTaxFiling();

        // Create download link
        const dataStr = JSON.stringify(t2125Data, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = `t2125-expenses-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        
        URL.revokeObjectURL(url);
      }

      function exportToCSV() {
        if (!window.expenseTracker) return;

        const tracker = window.expenseTracker;
        const expenses = tracker.expenses;

        if (expenses.length === 0) {
          alert('No expenses to export');
          return;
        }

        // Create CSV content
        const headers = ['Date', 'Vendor', 'Category', 'T2125 Line', 'Amount', 'Deduction Rate', 'Deductible Amount', 'Description'];
        const rows = expenses.map(exp => {
          const categoryInfo = window.EXPENSE_CATEGORIES[exp.category];
          return [
            exp.date,
            exp.vendor,
            categoryInfo.label,
            categoryInfo.code,
            exp.amount.toFixed(2),
            (exp.deductionRate * 100).toFixed(0) + '%',
            exp.deductibleAmount.toFixed(2),
            exp.description || '',
          ];
        });

        let csvContent = headers.join(',') + '\n';
        rows.forEach(row => {
          csvContent += row.map(field => `"${field}"`).join(',') + '\n';
        });

        // Create download link
        const dataBlob = new Blob([csvContent], { type: 'text/csv' });
        const url = URL.createObjectURL(dataBlob);
        
        const link = document.createElement('a');
        link.href = url;
        link.download = `business-expenses-${new Date().toISOString().split('T')[0]}.csv`;
        link.click();
        
        URL.revokeObjectURL(url);
      }

      function exportForAccountant() {
        if (!window.expenseTracker) {
          alert('No expense data to export');
          return;
        }
        const tracker = window.expenseTracker;
        const expenses = tracker.expenses;
        
        // Use shared income calculation
        const ytdIncome = calculateYTDIncome();
        
        const t2125Data = {
          exportDate: new Date().toISOString(),
          taxYear: new Date().getFullYear(),
          businessInfo: {
            businessName: "Rideshare Driver",
            businessActivity: "Taxi/Rideshare Services",
            businessCode: "485310"
          },
          income: {
            grossIncome: ytdIncome,
            otherIncome: 0,
            totalIncome: ytdIncome
          },
          expenses: mapExpensesToT2125(tracker),
          summary: {
            totalExpenses: tracker.getTotalDeductions(),
            netIncome: ytdIncome - tracker.getTotalDeductions()
          },
          transactions: expenses.map(exp => ({
            date: exp.date,
            vendor: exp.vendor,
            category: exp.category,
            t2125Line: window.EXPENSE_CATEGORIES[exp.category]?.code || 'N/A',
            amount: exp.amount,
            deductibleAmount: exp.deductibleAmount,
            description: exp.description,
            receiptAttached: !!exp.receiptImage
          })),
          warnings: {
            missingReceipts: expenses.filter(e => e.amount > 75 && !e.receiptImage).length
          }
        };
        
        const blob = new Blob([JSON.stringify(t2125Data, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `T2125-Export-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
        
        alert('‚úÖ T2125 export complete! Share this file with your accountant.');
      }

      function mapExpensesToT2125(tracker) {
        const breakdown = tracker.getCategoryBreakdown();
        return {
          line9270_Maintenance: breakdown.find(c => c.category === 'Repairs & Maintenance')?.total || 0,
          line9281_VehicleExpenses: breakdown.find(c => c.category === 'Vehicle Expenses')?.total || 0,
          line8810_OfficeExpenses: breakdown.find(c => c.category === 'Office Expenses')?.total || 0,
          line9220_PhoneUtilities: breakdown.find(c => c.category === 'Phone & Utilities')?.total || 0,
          line8960_Rent: breakdown.find(c => c.category === 'Rent')?.total || 0,
          line8523_Insurance: breakdown.find(c => c.category === 'Insurance')?.total || 0
        };
      }

      // Initialize expense summary on page load
      document.addEventListener('DOMContentLoaded', function() {
        updateExpenseSummary();
        
        // Set default date to today
        const expenseDateField = document.getElementById('expenseDate');
        if (expenseDateField) {
          expenseDateField.value = new Date().toISOString().split('T')[0];
        }
      });
    </script>

    <!-- Medical Expenses Calculator -->
    <script type="module">
      import { calculateMedicalExpenseCredit, trackMedicalExpensesByCategory, validateMedicalExpense } from './medical-expense-calculator.js';

      let medicalExpenses = [];

      window.addMedicalExpense = function() {
        const category = document.getElementById('medicalCategory').value;
        const amount = parseFloat(document.getElementById('medicalAmount').value);
        const date = document.getElementById('medicalDate').value;
        const description = document.getElementById('medicalDescription').value;

        const validation = validateMedicalExpense(amount, category, description);
        if (!validation.isValid) {
          alert('Error: ' + validation.errors.join(', '));
          return;
        }

        medicalExpenses.push({ category, amount, date, description });
        updateMedicalExpensesList();
        
        // Clear form
        document.getElementById('medicalAmount').value = '';
        document.getElementById('medicalDescription').value = '';
      };

      function updateMedicalExpensesList() {
        const tracked = trackMedicalExpensesByCategory(medicalExpenses);
        const tableDiv = document.getElementById('medicalExpensesTable');
        
        if (medicalExpenses.length === 0) {
          tableDiv.innerHTML = '<p style="color: var(--muted);">No expenses recorded yet.</p>';
          return;
        }

        let html = '<table style="width: 100%; border-collapse: collapse;">';
        html += '<thead><tr><th>Date</th><th>Category</th><th>Description</th><th>Amount</th></tr></thead><tbody>';
        
        medicalExpenses.forEach((exp, idx) => {
          const icon = { prescriptions: 'üíä', dental: 'ü¶∑', vision: 'üëì', practitioners: 'ü©∫', other: 'üìã' }[exp.category] || 'üìã';
          html += `<tr>
            <td>${exp.date || 'N/A'}</td>
            <td>${icon} ${exp.category}</td>
            <td>${exp.description}</td>
            <td>$${exp.amount.toFixed(2)}</td>
          </tr>`;
        });
        
        html += '</tbody></table>';
        html += `<p style="margin-top: 1rem;"><strong>Total: $${tracked.grandTotal.toFixed(2)}</strong></p>`;
        tableDiv.innerHTML = html;
      }

      window.calculateMedicalCredit = function() {
        const netIncome = parseFloat(document.getElementById('medicalNetIncome').value) || 0;
        const tracked = trackMedicalExpensesByCategory(medicalExpenses);
        const totalExpenses = tracked.grandTotal;

        const result = calculateMedicalExpenseCredit(totalExpenses, netIncome);

        document.getElementById('medicalTotalExpenses').textContent = '$' + result.totalExpenses.toFixed(2);
        document.getElementById('medicalThreshold').textContent = '$' + result.threshold.toFixed(2);
        document.getElementById('medicalEligible').textContent = '$' + result.eligibleAmount.toFixed(2);
        document.getElementById('medicalFederalCredit').textContent = '$' + result.federalCredit.toFixed(2);
        document.getElementById('medicalQuebecCredit').textContent = '$' + result.quebecCredit.toFixed(2);
        document.getElementById('medicalTotalCredit').textContent = '$' + result.totalCredit.toFixed(2);
      };
    </script>

    <!-- Childcare Expenses Calculator -->
    <script type="module">
      import { calculateChildcareDeduction, validateChildcareProvider, validateChild } from './childcare-expense-calculator.js';

      let children = [];

      window.addChild = function() {
        const age = parseInt(document.getElementById('childAge').value);
        const disabled = document.getElementById('childDisabled').value === 'true';

        const validation = validateChild(age, disabled);
        if (!validation.isValid) {
          alert('Error: ' + validation.errors.join(', '));
          return;
        }

        children.push({ age, disabled });
        updateChildrenList();
        
        // Clear form
        document.getElementById('childAge').value = '';
        document.getElementById('childDisabled').value = 'false';
      };

      function updateChildrenList() {
        const tableDiv = document.getElementById('childrenTable');
        
        if (children.length === 0) {
          tableDiv.innerHTML = '<p style="color: var(--muted);">No children added yet.</p>';
          return;
        }

        let html = '<table style="width: 100%; border-collapse: collapse;">';
        html += '<thead><tr><th>Age</th><th>Has Disability</th><th>Limit</th></tr></thead><tbody>';
        
        children.forEach((child, idx) => {
          let limit = 0;
          if (child.disabled) limit = 11000;
          else if (child.age < 7) limit = 8000;
          else if (child.age <= 16) limit = 5000;
          
          html += `<tr>
            <td>${child.age} years</td>
            <td>${child.disabled ? 'Yes' : 'No'}</td>
            <td>$${limit.toFixed(2)}</td>
          </tr>`;
        });
        
        html += '</tbody></table>';
        tableDiv.innerHTML = html;
      }

      window.calculateChildcareDeduction = function() {
        const totalExpenses = parseFloat(document.getElementById('childcareExpenseAmount').value) || 0;
        const earnedIncome = parseFloat(document.getElementById('childcareEarnedIncome').value) || 0;
        const providerName = document.getElementById('providerName').value;
        const providerSinBn = document.getElementById('providerSinBn').value;

        if (children.length === 0) {
          alert('Please add at least one child first.');
          return;
        }

        // Validate provider
        const providerValidation = validateChildcareProvider(providerSinBn, providerName);
        if (!providerValidation.isValid) {
          alert('Provider validation: ' + providerValidation.errors.join(', '));
          return;
        }

        const result = calculateChildcareDeduction(children, totalExpenses, earnedIncome);

        document.getElementById('childcareTotalExpenses').textContent = '$' + result.totalExpenses.toFixed(2);
        document.getElementById('childcarePerChildLimit').textContent = '$' + result.perChildLimit.toFixed(2);
        document.getElementById('childcareIncomeLimit').textContent = '$' + result.earnedIncomeLimit.toFixed(2);
        document.getElementById('childcareDeduction').textContent = '$' + result.eligibleDeduction.toFixed(2);

        const limitMessages = {
          'earned_income': 'Limited by 2/3 of earned income',
          'per_child': 'Limited by per-child maximum',
          'expenses': 'All expenses are deductible (within limits)'
        };
        document.getElementById('childcareLimitMessage').textContent = limitMessages[result.limitingFactor];
      };
    </script>

    <!-- Charitable Donations Calculator -->
    <script type="module">
      import { calculateCharitableCredit, verifyCharityRegistration, trackDonationsByCharity, calculateDonationTaxSavings } from './charitable-donation-calculator.js';

      let donations = [];

      window.addDonation = function() {
        const charityName = document.getElementById('charityName').value;
        const amount = parseFloat(document.getElementById('donationAmount').value);
        const registrationNumber = document.getElementById('registrationNumber').value;
        const date = document.getElementById('donationDate').value;

        if (!charityName || amount <= 0) {
          alert('Please enter charity name and amount.');
          return;
        }

        // Validate registration number if provided
        if (registrationNumber && registrationNumber.trim().length > 0) {
          const validation = verifyCharityRegistration(registrationNumber);
          if (!validation.isValid) {
            const proceed = confirm('Registration number appears invalid: ' + validation.errors.join(', ') + '. Add anyway?');
            if (!proceed) return;
          }
        }

        donations.push({ charityName, amount, registrationNumber, date });
        updateDonationsList();
        
        // Clear form
        document.getElementById('charityName').value = '';
        document.getElementById('donationAmount').value = '';
        document.getElementById('registrationNumber').value = '';
      };

      function updateDonationsList() {
        const tableDiv = document.getElementById('donationsTable');
        
        if (donations.length === 0) {
          tableDiv.innerHTML = '<p style="color: var(--muted);">No donations recorded yet.</p>';
          return;
        }

        const tracked = trackDonationsByCharity(donations);

        let html = '<table style="width: 100%; border-collapse: collapse;">';
        html += '<thead><tr><th>Date</th><th>Charity</th><th>Registration #</th><th>Amount</th></tr></thead><tbody>';
        
        donations.forEach((don, idx) => {
          html += `<tr>
            <td>${don.date || 'N/A'}</td>
            <td>${don.charityName}</td>
            <td style="font-family: monospace; font-size: 0.85em;">${don.registrationNumber || 'N/A'}</td>
            <td>$${don.amount.toFixed(2)}</td>
          </tr>`;
        });
        
        html += '</tbody></table>';
        html += `<p style="margin-top: 1rem;"><strong>Total: $${tracked.grandTotal.toFixed(2)}</strong></p>`;
        tableDiv.innerHTML = html;
      }

      window.calculateDonationCredit = function() {
        const tracked = trackDonationsByCharity(donations);
        const totalDonations = tracked.grandTotal;

        const result = calculateDonationTaxSavings(totalDonations);

        document.getElementById('donationTotal').textContent = '$' + result.totalDonations.toFixed(2);
        document.getElementById('donationFirstTier').textContent = '$' + result.firstTierAmount.toFixed(2);
        document.getElementById('donationSecondTier').textContent = '$' + result.secondTierAmount.toFixed(2);
        document.getElementById('donationFederalCredit').textContent = '$' + result.federalCredit.toFixed(2);
        document.getElementById('donationQuebecCredit').textContent = '$' + result.quebecCredit.toFixed(2);
        document.getElementById('donationTotalCredit').textContent = '$' + result.totalCredit.toFixed(2);
        document.getElementById('donationEffectiveRate').textContent = result.effectiveRate.toFixed(1) + '%';
        document.getElementById('donationNetCost').textContent = '$' + result.netCost.toFixed(2);
      };
    </script>
    
    <!-- Province Selector and Ontario Trillium Calculator -->
    <script>
      // Province selection handler
      let selectedProvince = 'QC'; // Default to Quebec
      
      document.addEventListener('DOMContentLoaded', function() {
        const provinceSelect = document.getElementById('provinceSelect');
        if (provinceSelect) {
          provinceSelect.addEventListener('change', function(e) {
            selectedProvince = e.target.value;
            
            // Hide all province-specific sections and tabs
            document.querySelectorAll('.province-specific').forEach(el => {
              el.style.display = 'none';
            });
            
            // Show sections for selected province
            const provinceClass = selectedProvince.toLowerCase() + '-only';
            document.querySelectorAll('.' + provinceClass).forEach(el => {
              el.style.display = 'block';
            });
            
            // If a province-specific tab is currently active, switch to vehicle tab
            const activeTab = document.querySelector('.tab-content.active');
            if (activeTab && activeTab.classList.contains('province-specific') && 
                !activeTab.classList.contains(provinceClass)) {
              document.querySelector('.tab-btn[data-tab="vehicle"]').click();
            }
          });
        }
        
        // Ontario Trillium calculator
        const calculateBtn = document.getElementById('calculateOntarioTrilliumBtn');
        if (calculateBtn) {
          calculateBtn.addEventListener('click', function() {
            const postalCode = document.getElementById('ontarioPostalCode').value || '';
            const isNorthern = window.isNorthernOntario && window.isNorthernOntario(postalCode);
            
            const household = {
              netIncome: parseFloat(document.getElementById('ontarioNetIncome').value) || 0,
              familyNetIncome: parseFloat(document.getElementById('ontarioFamilyIncome').value) || null,
              numberOfChildren: parseInt(document.getElementById('ontarioChildren').value) || 0,
              isSenior: document.getElementById('ontarioSenior').checked,
              isNorthernOntario: isNorthern,
              propertyTaxPaid: parseFloat(document.getElementById('ontarioPropertyTax').value) || 0,
              rentPaid: parseFloat(document.getElementById('ontarioRent').value) || 0,
              maritalStatus: document.getElementById('ontarioMaritalStatus').value,
            };
            
            if (!window.calculateOntarioTrilliumBenefit) {
              console.error('Ontario Trillium calculator not loaded');
              return;
            }
            
            const result = window.calculateOntarioTrilliumBenefit(household);
            
            // Display results
            document.getElementById('ontarioTrilliumResults').style.display = 'block';
            document.getElementById('ontarioEPTC').textContent = '$' + result.energyPropertyCredit.toFixed(2);
            document.getElementById('ontarioSTC').textContent = '$' + result.salesTaxCredit.toFixed(2);
            document.getElementById('ontarioTrilliumTotal').textContent = '$' + result.totalAnnualBenefit.toFixed(2);
            document.getElementById('ontarioTrilliumMonthly').textContent = '$' + result.monthlyPayment.toFixed(2);
            
            // Show Northern credit if applicable
            const northernCard = document.getElementById('northernCreditCard');
            if (isNorthern && northernCard) {
              northernCard.style.display = 'block';
              document.getElementById('ontarioNorthern').textContent = '$' + result.northernCredit.toFixed(2);
            } else if (northernCard) {
              northernCard.style.display = 'none';
            }
          });
        }
        
        // BC Climate Action Tax Credit calculator
        const bcClimateBtn = document.getElementById('calculateBCClimateBtn');
        if (bcClimateBtn) {
          bcClimateBtn.addEventListener('click', function() {
            const household = {
              netIncome: parseFloat(document.getElementById('bcFamilyIncome').value) || 0,
              familyNetIncome: parseFloat(document.getElementById('bcFamilyIncome').value) || 0,
              numberOfAdults: parseInt(document.getElementById('bcNumberOfAdults').value) || 1,
              numberOfChildren: parseInt(document.getElementById('bcNumberOfChildren').value) || 0,
              maritalStatus: document.getElementById('bcMaritalStatus').value,
            };
            
            if (!window.calculateBCClimateAction) {
              console.error('BC Climate Action calculator not loaded');
              return;
            }
            
            const result = window.calculateBCClimateAction(household);
            
            document.getElementById('bcClimateResults').style.display = 'block';
            document.getElementById('bcClimateAnnual').textContent = '$' + result.annualCredit.toFixed(2);
            document.getElementById('bcClimateQuarterly').textContent = '$' + result.quarterlyPayment.toFixed(2);
            
            // Update payment schedule
            ['bcPayment1', 'bcPayment2', 'bcPayment3', 'bcPayment4'].forEach(id => {
              document.getElementById(id).textContent = '$' + result.quarterlyPayment.toFixed(2);
            });
          });
        }
        
        // BC Affordability Credit calculator
        const bcAffordBtn = document.getElementById('calculateBCAffordBtn');
        if (bcAffordBtn) {
          bcAffordBtn.addEventListener('click', function() {
            const household = {
              netIncome: parseFloat(document.getElementById('bcAffordIncome').value) || 0,
              familyNetIncome: parseFloat(document.getElementById('bcAffordIncome').value) || 0,
              numberOfChildren: parseInt(document.getElementById('bcAffordChildren').value) || 0,
              maritalStatus: document.getElementById('bcAffordMaritalStatus').value,
            };
            
            if (!window.calculateBCAffordability) {
              console.error('BC Affordability calculator not loaded');
              return;
            }
            
            const result = window.calculateBCAffordability(household);
            
            document.getElementById('bcAffordResults').style.display = 'block';
            document.getElementById('bcAffordCredit').textContent = '$' + result.annualCredit.toFixed(2);
          });
        }
        
        // BC Home Owner Grant calculator
        const bcHomeGrantBtn = document.getElementById('calculateBCHomeGrantBtn');
        if (bcHomeGrantBtn) {
          bcHomeGrantBtn.addEventListener('click', function() {
            const property = {
              assessedValue: parseFloat(document.getElementById('bcPropertyValue').value) || 0,
              ownerAge: parseInt(document.getElementById('bcOwnerAge').value) || 0,
              municipality: document.getElementById('bcMunicipality').value,
              isDisabled: document.getElementById('bcIsDisabled').checked,
              isVeteran: document.getElementById('bcIsVeteran').checked,
              isNorthern: document.getElementById('bcIsNorthern').checked,
            };
            
            if (!window.calculateBCHomeOwnerGrant) {
              console.error('BC Home Owner Grant calculator not loaded');
              return;
            }
            
            const result = window.calculateBCHomeOwnerGrant(property);
            
            document.getElementById('bcHomeGrantResults').style.display = 'block';
            document.getElementById('bcHomeGrant').textContent = '$' + result.grant.toFixed(2);
            
            let note = result.qualifiesForNorthern ? 'Northern/Rural area grant' : 'Regular grant';
            if (result.seniorBonus) {
              note += ' + Senior/Disability bonus';
            }
            document.getElementById('bcHomeGrantNote').textContent = note;
          });
        }
        
        // Universal Provincial Tax Calculator
        const calculateUniversalBtn = document.getElementById('calculateUniversalBtn');
        if (calculateUniversalBtn) {
          calculateUniversalBtn.addEventListener('click', function() {
            const taxableIncome = parseFloat(document.getElementById('universalTaxableIncome').value) || 0;
            const selectedProvince = document.getElementById('provinceSelect').value;
            
            let result;
            let provinceName;
            
            // Calculate tax based on province
            switch(selectedProvince) {
              case 'MB':
                result = window.calculateManitobaTax(taxableIncome);
                provinceName = 'Manitoba';
                break;
              case 'SK':
                result = window.calculateSaskatchewanTax(taxableIncome);
                provinceName = 'Saskatchewan';
                break;
              case 'NS':
                result = window.calculateNovaScotiaTax(taxableIncome);
                provinceName = 'Nova Scotia';
                break;
              case 'NB':
                result = window.calculateNewBrunswickTax(taxableIncome);
                provinceName = 'New Brunswick';
                break;
              case 'PE':
                result = window.calculatePEITax(taxableIncome);
                provinceName = 'Prince Edward Island';
                break;
              case 'NL':
                result = window.calculateNewfoundlandTax(taxableIncome);
                provinceName = 'Newfoundland and Labrador';
                break;
              case 'YT':
                result = window.calculateYukonTax(taxableIncome);
                provinceName = 'Yukon';
                break;
              case 'NT':
                result = window.calculateNWTTax(taxableIncome);
                provinceName = 'Northwest Territories';
                break;
              case 'NU':
                result = window.calculateNunavutTax(taxableIncome);
                provinceName = 'Nunavut';
                break;
              default:
                alert('Please select a valid province/territory');
                return;
            }
            
            // Display results
            document.getElementById('universalResults').style.display = 'block';
            document.getElementById('universalProvincialTax').textContent = '$' + result.provincialTax.toFixed(2);
            
            const effectiveRate = taxableIncome > 0 ? (result.totalTax / taxableIncome * 100).toFixed(2) : '0.00';
            document.getElementById('universalEffectiveRate').textContent = effectiveRate + '%';
            
            // Update province name in heading
            document.getElementById('provinceName').textContent = provinceName;
          });
        }
        
        // Northern Residents Deduction Calculator
        const calculateNorthernBtn = document.getElementById('calculateNorthernBtn');
        if (calculateNorthernBtn) {
          calculateNorthernBtn.addEventListener('click', function() {
            const selectedProvince = document.getElementById('provinceSelect').value;
            const zone = window.getNorthernZone(selectedProvince);
            
            const residency = {
              zone: zone,
              daysInZone: parseInt(document.getElementById('northernDays').value) || 365,
              numberOfTrips: parseInt(document.getElementById('northernTrips').value) || 0,
              travelCosts: parseFloat(document.getElementById('northernTravelCosts').value) || 0,
            };
            
            if (!window.calculateNorthernResidentsDeduction) {
              console.error('Northern Residents Deduction calculator not loaded');
              return;
            }
            
            const result = window.calculateNorthernResidentsDeduction(residency);
            
            // Display results
            document.getElementById('northernResults').style.display = 'block';
            document.getElementById('northernResidency').textContent = '$' + result.residencyDeduction.toFixed(2);
            document.getElementById('northernTravel').textContent = '$' + result.travelDeduction.toFixed(2);
            document.getElementById('northernTotal').textContent = '$' + result.totalDeduction.toFixed(2);
          });
        }
        
        // Update basic personal amount when province changes
        // Reuse existing provinceSelect reference
        if (provinceSelect) {
          provinceSelect.addEventListener('change', function() {
            const selectedProvince = provinceSelect.value;
            const basicAmountField = document.getElementById('universalBasicAmount');
            
            if (!basicAmountField) return;
            
            const basicAmounts = {
              'MB': 15780,
              'SK': 17661,
              'NS': 11481,
              'NB': 13044,
              'PE': 13500,
              'NL': 10382,
              'YT': 15705,
              'NT': 16593,
              'NU': 17925,
            };
            
            basicAmountField.value = basicAmounts[selectedProvince] || '';
          });
          
          // Trigger change on load to set initial value
          provinceSelect.dispatchEvent(new Event('change'));
        // Alberta Child & Family Benefit calculator
        const albertaChildBtn = document.getElementById('calculateAlbertaChildBtn');
        if (albertaChildBtn) {
          albertaChildBtn.addEventListener('click', function() {
            const household = {
              familyNetIncome: parseFloat(document.getElementById('albertaFamilyIncome').value) || 0,
              numberOfChildren: parseInt(document.getElementById('albertaNumberOfChildren').value) || 0,
            };
            
            if (!window.calculateAlbertaChildBenefit) {
              console.error('Alberta Child Benefit calculator not loaded');
              return;
            }
            
            const result = window.calculateAlbertaChildBenefit(household);
            
            document.getElementById('albertaChildResults').style.display = 'block';
            document.getElementById('albertaChildAnnual').textContent = '$' + result.annualBenefit.toFixed(2);
            document.getElementById('albertaChildMonthly').textContent = '$' + result.monthlyPayment.toFixed(2);
            
            // Show breakdown
            const breakdown = document.getElementById('albertaChildBreakdown');
            breakdown.innerHTML = '';
            
            if (result.breakdown.firstChild > 0) {
              breakdown.innerHTML += '<li>1st child: $' + result.breakdown.firstChild.toFixed(2) + '</li>';
            }
            if (result.breakdown.secondChild > 0) {
              breakdown.innerHTML += '<li>2nd child: $' + result.breakdown.secondChild.toFixed(2) + '</li>';
            }
            if (result.breakdown.thirdChild > 0) {
              breakdown.innerHTML += '<li>3rd child: $' + result.breakdown.thirdChild.toFixed(2) + '</li>';
            }
            if (result.breakdown.additionalChildren > 0) {
              breakdown.innerHTML += '<li>Additional children: $' + result.breakdown.additionalChildren.toFixed(2) + '</li>';
            }
          });
        }
        
        // Alberta Seniors Benefit calculator
        const albertaSeniorsBtn = document.getElementById('calculateAlbertaSeniorsBtn');
        if (albertaSeniorsBtn) {
          albertaSeniorsBtn.addEventListener('click', function() {
            const senior = {
              age: parseInt(document.getElementById('albertaSeniorAge').value) || 0,
              netIncome: parseFloat(document.getElementById('albertaSeniorIncome').value) || 0,
              maritalStatus: document.getElementById('albertaSeniorMarital').value,
              spouseAge: parseInt(document.getElementById('albertaSpouseAge').value) || 0,
              spouseIncome: parseFloat(document.getElementById('albertaSpouseIncomeField').value) || 0,
            };
            
            if (!window.calculateAlbertaSeniorsBenefit) {
              console.error('Alberta Seniors Benefit calculator not loaded');
              return;
            }
            
            const result = window.calculateAlbertaSeniorsBenefit(senior);
            
            document.getElementById('albertaSeniorsResults').style.display = 'block';
            
            if (result.eligible) {
              document.getElementById('albertaSeniorsAnnual').textContent = '$' + result.annualBenefit.toFixed(2);
              document.getElementById('albertaSeniorsMonthly').textContent = '$' + result.monthlyPayment.toFixed(2);
            } else {
              document.getElementById('albertaSeniorsAnnual').textContent = 'Not Eligible';
              document.getElementById('albertaSeniorsMonthly').textContent = result.reason;
            }
          });
        }
        
        // Show/hide spouse fields for Alberta Seniors
        const albertaSeniorMarital = document.getElementById('albertaSeniorMarital');
        if (albertaSeniorMarital) {
          albertaSeniorMarital.addEventListener('change', function() {
            const isMarried = this.value === 'married' || this.value === 'common-law';
            document.getElementById('albertaSpouseFields').style.display = isMarried ? 'block' : 'none';
            document.getElementById('albertaSpouseIncome').style.display = isMarried ? 'block' : 'none';
          });
        }
        
        // Alberta Family Employment Credit calculator
        const albertaEmploymentBtn = document.getElementById('calculateAlbertaEmploymentBtn');
        if (albertaEmploymentBtn) {
          albertaEmploymentBtn.addEventListener('click', function() {
            const household = {
              workingIncome: parseFloat(document.getElementById('albertaWorkingIncome').value) || 0,
              familyNetIncome: parseFloat(document.getElementById('albertaEmploymentFamilyIncome').value) || 0,
              numberOfChildren: parseInt(document.getElementById('albertaEmploymentChildren').value) || 0,
            };
            
            if (!window.calculateAlbertaFamilyEmploymentCredit) {
              console.error('Alberta Family Employment Credit calculator not loaded');
              return;
            }
            
            const result = window.calculateAlbertaFamilyEmploymentCredit(household);
            
            document.getElementById('albertaEmploymentResults').style.display = 'block';
            
            if (result.eligible) {
              document.getElementById('albertaEmploymentCredit').textContent = '$' + result.credit.toFixed(2);
              document.getElementById('albertaEmploymentNote').textContent = 'Maximum: $' + result.maxCredit;
            } else {
              document.getElementById('albertaEmploymentCredit').textContent = '$0.00';
              document.getElementById('albertaEmploymentNote').textContent = result.reason;
            }
          });
        }
        
        // Alberta Tax Comparison calculator
        const albertaCompareBtn = document.getElementById('calculateAlbertaCompareBtn');
        if (albertaCompareBtn) {
          albertaCompareBtn.addEventListener('click', function() {
            const income = parseFloat(document.getElementById('albertaCompareIncome').value) || 0;
            
            // Check calculator availability
            if (!window.calculateAlbertaTax) {
              console.error('Alberta tax calculator not loaded');
              alert('Error: Alberta tax calculator not available');
              return;
            }
            if (!window.calculateBCTax) {
              console.error('BC tax calculator not loaded');
              alert('Error: BC tax calculator not available');
              return;
            }
            if (!window.calculateOntarioTax) {
              console.error('Ontario tax calculator not loaded');
              alert('Error: Ontario tax calculator not available');
              return;
            }
            
            // Calculate taxes for different provinces
            const albertaTax = window.calculateAlbertaTax(income).totalTax;
            const bcTax = window.calculateBCTax(income).totalTax;
            const ontarioTax = window.calculateOntarioTax(income).totalTax;
            
            // Create comparison table
            const tableBody = document.getElementById('albertaCompareTableBody');
            tableBody.innerHTML = '';
            
            const provinces = [
              { name: 'Alberta', tax: albertaTax },
              { name: 'British Columbia', tax: bcTax },
              { name: 'Ontario', tax: ontarioTax },
            ];
            
            provinces.forEach(province => {
              const row = document.createElement('tr');
              const diff = province.tax - albertaTax;
              const diffText = diff === 0 ? '-' : (diff > 0 ? '+$' + diff.toFixed(2) : '-$' + Math.abs(diff).toFixed(2));
              
              row.innerHTML = `
                <td>${province.name}</td>
                <td>$${province.tax.toFixed(2)}</td>
                <td>${diffText}</td>
              `;
              
              tableBody.appendChild(row);
            });
            
            // Calculate average savings
            const avgOtherTax = (bcTax + ontarioTax) / 2;
            const savings = avgOtherTax - albertaTax;
            
            document.getElementById('albertaCompareResults').style.display = 'block';
            document.getElementById('albertaSavingsAmount').textContent = 
              savings > 0 
                ? `You save an average of $${savings.toFixed(2)} compared to BC and Ontario!` 
                : 'Alberta offers competitive tax rates.';
          });
        }
      });
    </script>
    
    <!-- Province Language Switching Integration -->
    <script>
      // Global function to update province dropdown with translated names
      function updateProvinceDropdown(language) {
        const select = document.getElementById('provinceSelect');
        if (!select) return;
        
        // Check if province options function is available
        if (!window.getProvinceOptions) {
          console.error('Province options function not available');
          return;
        }
        
        const currentValue = select.value || 'QC';
        const options = window.getProvinceOptions(language);
        
        // Clear existing options
        select.innerHTML = '';
        
        // Add new options in selected language
        options.forEach(opt => {
          const option = document.createElement('option');
          option.value = opt.code;
          option.textContent = opt.name;
          if (opt.code === currentValue) {
            option.selected = true;
          }
          select.appendChild(option);
        });
      }
      
      // Make function available globally
      window.updateProvinceDropdown = updateProvinceDropdown;
    </script>
    
    <script type="module">
      import { getProvinceOptions, detectLanguage } from './province-language-fix.js';
      
      // Make available globally for onclick handlers and updateProvinceDropdown
      window.getProvinceOptions = getProvinceOptions;
      window.detectLanguage = detectLanguage;
      
      // Initialize on page load
      document.addEventListener('DOMContentLoaded', function() {
        const browserLang = detectLanguage();
        setLang(browserLang);
      });
    </script>
  </body>
</html>
